<div class="dashboard-layout" [class.sidebar-collapsed]="sidebarCollapsed">
  <!-- Email Verification Alert -->
  <div class="verification-alert error" *ngIf="needsEmailVerification()">
    <div class="alert-content">
      <span class="material-icons">warning</span>
      <div class="alert-text">
        <strong>V√©rification d'email requise</strong>
        <p>Veuillez v√©rifier votre adresse email pour acc√©der √† toutes les fonctionnalit√©s.</p>
      </div>
      <button class="btn btn-sm btn-primary" routerLink="/verify-email">
        V√©rifier maintenant
      </button>
    </div>
  </div>

  <!-- Agency Verification Alert -->
  <div class="verification-alert warning" *ngIf="needsAgencyVerification()">
    <div class="alert-content">
      <span class="material-icons">business</span>
      <div class="alert-text">
        <strong>V√©rification d'agence en attente</strong>
        <p>Votre agence est en cours de v√©rification. Certaines fonctionnalit√©s sont limit√©es.</p>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="logo">
        <span class="logo-icon">üè†</span>
        <span class="logo-text" *ngIf="!sidebarCollapsed">ImmoConnect</span>
      </div>
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <span class="material-icons">
          {{ sidebarCollapsed ? 'menu' : 'close' }}
        </span>
      </button>
    </div>

    <!-- User Profile Section -->
    <div class="sidebar-user" *ngIf="currentUser && !sidebarCollapsed">
      <div class="user-avatar">
        {{ currentUser.prenom.charAt(0) }}{{ currentUser.nom.charAt(0) }}
      </div>
      <div class="user-info">
        <div class="user-name">{{ getUserDisplayName() }}</div>
        <div class="user-role">{{ getUserRoleDisplay() }}</div>
        <div class="user-status" *ngIf="isAgency()">
          <span class="status-badge" [class]="isAgencyVerified() ? 'verified' : 'pending'">
            <span class="material-icons">{{ isAgencyVerified() ? 'verified' : 'schedule' }}</span>
            {{ isAgencyVerified() ? 'V√©rifi√©e' : 'En attente' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar-nav">
      <div class="nav-section" *ngFor="let item of getCurrentNavigationItems()">
        <button class="nav-item" 
                [class.active]="activeSection === item.section"
                (click)="setActiveSection(item.section, $event)"
                [attr.title]="sidebarCollapsed ? item.label : ''"
                type="button">
          <span class="nav-icon material-icons">{{ item.icon }}</span>
          <div class="nav-content" *ngIf="!sidebarCollapsed">
            <span class="nav-label">{{ item.label }}</span>
            <span class="nav-description">{{ item.description }}</span>
          </div>
          <!-- Notification badge for comments -->
          <div class="notification-badge" 
               *ngIf="item.section === 'comments' && isAgency() && getCommentNotificationCount() > 0">
            {{ getCommentNotificationCount() }}
          </div>
        </button>
      </div>
    </nav>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()" type="button">
        <span class="nav-icon material-icons">logout</span>
        <span class="logout-text" *ngIf="!sidebarCollapsed">D√©connexion</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="page-title">
        <h1>{{ getSectionInfo(activeSection).label }}</h1>
        <p>{{ getSectionInfo(activeSection).description }}</p>
      </div>
      <div class="top-actions">
        <button class="btn btn-outline" (click)="refreshData()" [disabled]="isLoading">
          <span class="material-icons">refresh</span>
          <span *ngIf="!sidebarCollapsed">Actualiser</span>
        </button>
        <button class="btn btn-primary" (click)="goToProfile()">
          <span class="material-icons">person</span>
          <span *ngIf="!sidebarCollapsed">Profil</span>
        </button>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area">
      <div class="loading-overlay" *ngIf="isLoading">
        <div class="loading-spinner"></div>
        <p>Chargement en cours...</p>
      </div>


      <!-- UTILISATEUR Dashboard -->
      <div *ngIf="isRegularUser()" class="dashboard-content">
        <!-- Overview Section -->
        <div *ngIf="activeSection === 'overview'" class="section-content">
          <!-- Personalized Welcome Card -->
          <div class="welcome-card">
            <div class="card-content">
              <h2>Bienvenue {{ getUserDisplayName() }} !</h2>
              <p>Votre compte {{ getUserRoleDisplay() }} sur ImmoConnect</p>
              <div class="user-activity-summary">
                <div class="activity-item">
                  <span class="material-icons">search</span>
                  <div class="activity-content">
                    <span class="activity-number">{{ getUserActivityStats().totalSearches || 0 }}</span>
                    <span class="activity-label">Recherches effectu√©es</span>
                  </div>
                </div>
                <div class="activity-item">
                  <span class="material-icons">favorite</span>
                  <div class="activity-content">
                    <span class="activity-number">{{ getUserActivityStats().savedProperties || 0 }}</span>
                    <span class="activity-label">Biens favoris</span>
                  </div>
                </div>
                <div class="activity-item">
                  <span class="material-icons">visibility</span>
                  <div class="activity-content">
                    <span class="activity-number">{{ getUserActivityStats().viewedProperties || 0 }}</span>
                    <span class="activity-label">Biens consult√©s</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity Feed -->
          <div class="recent-activity-card">
            <h3>Activit√© r√©cente</h3>
            <div class="activity-feed" *ngIf="recentActivity && recentActivity.length > 0">
              <div class="activity-feed-item" *ngFor="let activity of recentActivity.slice(0, 5)">
                <div class="activity-icon">
                  <span class="material-icons">{{ activity.icon }}</span>
                </div>
                <div class="activity-details">
                  <div class="activity-title">{{ activity.title }}</div>
                  <div class="activity-time">{{ formatRelativeTime(activity.date) }}</div>
                </div>
              </div>
            </div>
            <div class="no-activity" *ngIf="!recentActivity || recentActivity.length === 0">
              <span class="material-icons">history</span>
              <p>Aucune activit√© r√©cente</p>
            </div>
          </div>

          <!-- Personalized Property Recommendations -->
          <div class="recommendations-card">
            <h3>Recommandations pour vous</h3>
            <div class="loading-recommendations" *ngIf="isLoadingRecommendations">
              <div class="loading-spinner"></div>
              <p>Chargement des recommandations...</p>
            </div>
            <div class="recommendations-grid" *ngIf="!isLoadingRecommendations && recommendedProperties && recommendedProperties.length > 0">
              <div class="recommendation-item" *ngFor="let property of recommendedProperties.slice(0, 3)">
                <div class="recommendation-image">
                  <img *ngIf="property.premierImage" [src]="property.premierImage" [alt]="property.titre">
                  <div *ngIf="!property.premierImage" class="default-image">
                    <span class="material-icons">home</span>
                  </div>
                </div>
                <div class="recommendation-info">
                  <h4>{{ property.titre }}</h4>
                  <p class="price">{{ formatPrice(property.prix) }} TND</p>
                  <p class="location">{{ property.ville }}</p>
                </div>
                <button class="btn btn-sm btn-primary" (click)="viewAnnonceDetails(property)">
                  <span class="material-icons">visibility</span>
                  Voir
                </button>
              </div>
            </div>
            <div class="no-recommendations" *ngIf="!isLoadingRecommendations && (!recommendedProperties || recommendedProperties.length === 0)">
              <span class="material-icons">explore</span>
              <p>Explorez des biens pour recevoir des recommandations personnalis√©es</p>
              <button class="btn btn-primary" (click)="setActiveSection('properties')">
                <span class="material-icons">search</span>
                Parcourir les biens
              </button>
            </div>
          </div>

          <div class="upgrade-section">
            <div class="upgrade-card">
              <div class="upgrade-content">
                <h3>Passez √† Premium</h3>
                <p>D√©bloquez toutes les fonctionnalit√©s avanc√©es</p>
                <ul class="premium-features">
                  <li>Recherche avanc√©e et filtres personnalis√©s</li>
                  <li>Alertes automatiques par email</li>
                  <li>Acc√®s prioritaire aux nouvelles annonces</li>
                  <li>Support client d√©di√©</li>
                </ul>
                <button class="btn btn-premium">
                  <span class="material-icons">star</span>
                  Passer √† Premium
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Section -->
        <div *ngIf="activeSection === 'profile'" class="section-content profile-section">
          <!-- Profile Header -->
          <div class="profile-section-header" *ngIf="!isEditingProfile">
            <div class="section-title">
              <h2>Mon Profil</h2>
              <p>G√©rez vos informations personnelles</p>
            </div>
            <button class="btn btn-primary" (click)="startEditProfile()">
              <span class="material-icons">edit</span>
              Modifier mes informations
            </button>
          </div>

          <!-- Profile View Mode -->
          <div *ngIf="!isEditingProfile">
            <app-profile-view [user]="currentUser"></app-profile-view>
          </div>

          <!-- Profile Edit Mode -->
          <div *ngIf="isEditingProfile">
            <app-profile-sections 
              [user]="currentUser"
              (saved)="onProfileSaved($event)"
              (cancelled)="cancelEditProfile()"
              (passwordChanged)="onPasswordChanged()">
            </app-profile-sections>
          </div>
        </div>

        <!-- Properties Browse Section -->
        <div *ngIf="activeSection === 'properties'" class="section-content">
          <div class="properties-header">
            <h2>Parcourir les Biens Immobiliers</h2>
            <p *ngIf="!isClientAbonne()" class="limitation-notice">
              <span class="material-icons">info</span>
              Version gratuite - Acc√®s limit√© √† {{ getMaxVisibleAnnonces() }} annonces. 
              <a (click)="setActiveSection('upgrade')" class="upgrade-link">Passer √† Premium</a> pour un acc√®s complet.
            </p>
          </div>

          <!-- Search Filters -->
          <div class="search-filters">
            <div class="filter-row">
              <div class="search-input">
                <span class="material-icons">search</span>
                <input type="text" 
                       placeholder="Rechercher par titre ou localisation..."
                       [(ngModel)]="searchQuery"
                       (input)="onSearch()"
                       class="form-control">
              </div>
              <div class="filter-select">
                <select [(ngModel)]="selectedTypeBien" (change)="onFilterChange()" class="form-control">
                  <option value="">Tous les types</option>
                  <option value="APPARTEMENT">Appartement</option>
                  <option value="VILLA">Villa</option>
                  <option value="MAISON">Maison</option>
                  <option value="STUDIO">Studio</option>
                </select>
              </div>
              <div class="filter-select">
                <select [(ngModel)]="selectedTypeTransaction" (change)="onFilterChange()" class="form-control">
                  <option value="">Vente ou Location</option>
                  <option value="VENTE">Vente</option>
                  <option value="LOCATION">Location</option>
                </select>
              </div>
              <button class="btn btn-secondary" (click)="clearSearch()">
                <span class="material-icons">clear</span>
                Effacer
              </button>
            </div>
          </div>

          <!-- Loading State -->
          <div class="loading-section" *ngIf="isLoadingPublicAnnonces">
            <div class="loading-spinner"></div>
            <p>Chargement des annonces...</p>
          </div>

          <!-- Properties Grid -->
          <div class="annonce-grid" *ngIf="!isLoadingPublicAnnonces && publicAnnonces?.content?.length">
            <div class="annonce-card" 
                 *ngFor="let annonce of publicAnnonces?.content?.slice(0, getMaxVisibleAnnonces()); let i = index">
              
              <!-- Main Image Section -->
              <div class="annonce-image-section">
                <div class="main-image-container">
                  <div *ngIf="annonce.premierImage" class="main-image">
                    <img [src]="annonce.premierImage" [alt]="annonce.titre">
                  </div>
                  <div *ngIf="!annonce.premierImage" class="default-image">
                    <span class="material-icons">{{ annonce.typeBien === 'VILLA' ? 'villa' : 'home' }}</span>
                  </div>
                  
                  <!-- Overlay badges -->
                  <div class="image-overlay">
                    <div class="badges">
                      <span class="badge transaction-badge">{{ getAnnonceTypeTransactionDisplay(annonce.typeTransaction) }}</span>
                      <span class="badge type-badge">{{ getAnnonceTypeBienDisplay(annonce.typeBien) }}</span>
                      <span class="badge status-badge status-active">Actif</span>
                    </div>
                    
                    <!-- Premium Feature: Rating Display -->
                    <div class="rating-display" *ngIf="isClientAbonne() && annonceRatings[annonce.id]">
                      <div class="rating-stars">
                        <span class="material-icons filled" *ngFor="let star of [1,2,3,4,5]; let j = index" 
                              [class.filled]="j < annonceRatings[annonce.id]">star</span>
                      </div>
                      <span class="rating-value">{{ annonceRatings[annonce.id] | number:'1.1-1' }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Info Section -->
              <div class="annonce-info-section">
                <!-- Title and Basic Info -->
                <div class="title-section">
                  <h3 class="annonce-title">{{ annonce.titre }}</h3>
                  <div class="basic-info">
                    <span class="price">{{ formatPrice(annonce.prix) }} <span class="currency">TND</span></span>
                  </div>
                </div>

                <!-- Location -->
                <div class="location-section">
                  <div class="location">
                    <span class="material-icons">location_on</span>
                    <span>{{ annonce.ville }}<span *ngIf="annonce.codePostal"> {{ annonce.codePostal }}</span></span>
                  </div>
                </div>

                <!-- Property Features -->
                <div class="features-section" *ngIf="canViewFullDetails() || isClientAbonne()">
                  <div class="features-grid">
                    <div class="feature-item" *ngIf="annonce.surface">
                      <span class="material-icons">square_foot</span>
                      <span class="feature-value">{{ annonce.surface }}m¬≤</span>
                    </div>
                    <div class="feature-item" *ngIf="annonce.nombreChambres">
                      <span class="material-icons">bed</span>
                      <span class="feature-value">{{ annonce.nombreChambres }}</span>
                    </div>
                    <div class="feature-item" *ngIf="annonce.nombreSallesBain">
                      <span class="material-icons">bathtub</span>
                      <span class="feature-value">{{ annonce.nombreSallesBain }}</span>
                    </div>
                  </div>
                </div>

                <!-- Limited view for regular users -->
                <div class="features-limited" *ngIf="!canViewFullDetails() && !isClientAbonne()">
                  <div class="blur-overlay">
                    <div class="upgrade-message">
                      <span class="material-icons">lock</span>
                      <span>D√©tails disponibles pour les abonn√©s Premium</span>
                    </div>
                  </div>
                </div>

                <!-- Contact and Actions -->
                <div class="contact-section" *ngIf="canViewFullDetails()">
                  <div class="contact-info">
                    <div class="contact-item">
                      <span class="material-icons">business</span>
                      <span>{{ annonce.createurNom }}</span>
                    </div>
                  </div>
                </div>

                <!-- Actions -->
                <div class="actions-section">
                  <div class="action-buttons">
                    <button class="btn btn-outline" (click)="viewAnnonceDetails(annonce)">
                      <span class="material-icons">visibility</span>
                      Voir D√©tails
                    </button>
                    
                    <button class="btn btn-primary" *ngIf="isClientAbonne()" 
                            (click)="openCommentModal(annonce)">
                      <span class="material-icons">comment</span>
                      Commenter
                    </button>
                    
                    <button class="btn btn-secondary" *ngIf="!canViewFullDetails()" 
                            (click)="setActiveSection('upgrade')">
                      <span class="material-icons">star</span>
                      Premium
                    </button>
                  </div>

                  <!-- Stats -->
                  <div class="stats-section">
                    <div class="stat-item">
                      <span class="material-icons">visibility</span>
                      <span>{{ annonce.vues }}</span>
                    </div>
                    <div class="stat-item" *ngIf="isClientAbonne()">
                      <span class="material-icons">favorite</span>
                      <span>{{ annonce.favoris }}</span>
                    </div>
                    <div class="stat-item" *ngIf="isClientAbonne()">
                      <span class="material-icons">comment</span>
                      <span>{{ annonceComments[annonce.id]?.length || 0 }}</span>
                    </div>
                  </div>
                </div>

                <!-- Metadata -->
                <div class="metadata-section">
                  <div class="metadata-item">
                    <span class="label">Publi√© le:</span>
                    <span class="value">{{ formatDate(annonce.dateCreation) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Results -->
          <div class="no-results" *ngIf="!isLoadingPublicAnnonces && (!publicAnnonces?.content?.length)">
            <div class="no-results-content">
              <span class="material-icons">search_off</span>
              <h3>Aucune annonce trouv√©e</h3>
              <p>Essayez de modifier vos crit√®res de recherche</p>
            </div>
          </div>

          <!-- Pagination -->
          <div class="pagination" *ngIf="publicAnnonces && publicAnnonces.totalPages > 1">
            <button class="btn btn-pagination" 
                    [disabled]="!publicAnnonces.hasPrevious"
                    (click)="loadPublicAnnonces(publicAnnonces.currentPage - 1)">
              <span class="material-icons">chevron_left</span>
              Pr√©c√©dent
            </button>
            
            <div class="pagination-pages">
              <button *ngFor="let page of getPaginationPages()" 
                      class="btn btn-page"
                      [class.active]="page === publicAnnonces.currentPage"
                      (click)="loadPublicAnnonces(page)">
                {{ page + 1 }}
              </button>
            </div>
            
            <button class="btn btn-pagination" 
                    [disabled]="!publicAnnonces.hasNext"
                    (click)="loadPublicAnnonces(publicAnnonces.currentPage + 1)">
              Suivant
              <span class="material-icons">chevron_right</span>
            </button>
          </div>
        </div>

        <!-- Upgrade Section -->
        <div *ngIf="activeSection === 'upgrade'" class="section-content">
          <!-- Premium Hero Section -->
          <div class="premium-hero">
            <div class="hero-content">
              <div class="hero-badge">
                <span class="material-icons">auto_awesome</span>
                <span>D√©bloquez votre potentiel</span>
              </div>
              <h1>Passez √† Premium d√®s aujourd'hui</h1>
              <p>Acc√©dez √† des fonctionnalit√©s exclusives et transformez votre exp√©rience immobili√®re</p>
              <div class="hero-stats">
                <div class="stat-item">
                  <span class="stat-number">10,000+</span>
                  <span class="stat-label">Biens exclusifs</span>
                </div>
                <div class="stat-item">
                  <span class="stat-number">95%</span>
                  <span class="stat-label">Satisfaction client</span>
                </div>
                <div class="stat-item">
                  <span class="stat-number">24/7</span>
                  <span class="stat-label">Support d√©di√©</span>
                </div>
              </div>
            </div>
            <div class="hero-visual">
              <div class="floating-cards">
                <div class="feature-card card-1">
                  <span class="material-icons">search</span>
                  <span>Recherche Avanc√©e</span>
                </div>
                <div class="feature-card card-2">
                  <span class="material-icons">notifications</span>
                  <span>Alertes Instantan√©es</span>
                </div>
                <div class="feature-card card-3">
                  <span class="material-icons">analytics</span>
                  <span>Analytics Pro</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Comparison Table -->
          <div class="plans-comparison">
            <div class="comparison-header">
              <h2>Choisissez votre plan</h2>
              <p>Comparez les fonctionnalit√©s et trouvez l'abonnement qui vous convient</p>
            </div>

            <div class="comparison-table">
              <!-- Current Plan -->
              <div class="plan-column current-plan">
                <div class="plan-header">
                  <div class="plan-icon">
                    <span class="material-icons">person</span>
                  </div>
                  <h3>Gratuit</h3>
                  <div class="plan-price">
                    <span class="price">0‚Ç¨</span>
                    <span class="period">/mois</span>
                  </div>
                  <div class="current-badge">Votre plan actuel</div>
                </div>
                
                <div class="plan-features">
                  <div class="feature-category">
                    <h4>Recherche</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Recherche de base</li>
                      <li><span class="icon limited">‚ö†</span>10 annonces/jour max</li>
                      <li><span class="icon cross">‚úó</span>Filtres avanc√©s</li>
                    </ul>
                  </div>
                  
                  <div class="feature-category">
                    <h4>Favoris & Alertes</h4>
                    <ul>
                      <li><span class="icon limited">‚ö†</span>5 favoris max</li>
                      <li><span class="icon cross">‚úó</span>Alertes automatiques</li>
                      <li><span class="icon cross">‚úó</span>Notifications push</li>
                    </ul>
                  </div>
                  
                  <div class="feature-category">
                    <h4>Support</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>FAQ et guides</li>
                      <li><span class="icon cross">‚úó</span>Support prioritaire</li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Premium Plan -->
              <div class="plan-column premium-plan popular">
                <div class="popular-badge">
                  <span class="material-icons">star</span>
                  <span>Le plus populaire</span>
                </div>
                <div class="plan-header">
                  <div class="plan-icon premium">
                    <span class="material-icons">workspace_premium</span>
                  </div>
                  <h3>Premium</h3>
                  <div class="plan-price">
                    <span class="price">29‚Ç¨</span>
                    <span class="period">/mois</span>
                  </div>
                  <div class="savings-badge">√âconomisez 20% en payant annuellement</div>
                </div>
                
                <div class="plan-features">
                  <div class="feature-category">
                    <h4>Recherche</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Recherche avanc√©e illimit√©e</li>
                      <li><span class="icon check">‚úì</span>Acc√®s √† toutes les annonces</li>
                      <li><span class="icon check">‚úì</span>Filtres g√©ographiques pr√©cis</li>
                    </ul>
                  </div>
                  
                  <div class="feature-category">
                    <h4>Favoris & Alertes</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Favoris illimit√©s</li>
                      <li><span class="icon check">‚úì</span>50 alertes automatiques</li>
                      <li><span class="icon check">‚úì</span>Notifications en temps r√©el</li>
                    </ul>
                  </div>
                  
                  <div class="feature-category">
                    <h4>Fonctionnalit√©s exclusives</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Statistiques d√©taill√©es</li>
                      <li><span class="icon check">‚úì</span>Historique des prix</li>
                      <li><span class="icon check">‚úì</span>Acc√®s prioritaire aux nouveaut√©s</li>
                    </ul>
                  </div>
                  
                  <div class="feature-category">
                    <h4>Support</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Support email prioritaire</li>
                      <li><span class="icon check">‚úì</span>Chat en direct</li>
                    </ul>
                  </div>
                </div>
                
                <button class="btn btn-premium-cta" (click)="upgradeToPremium()">
                  <span class="material-icons">rocket_launch</span>
                  Passer √† Premium
                  <span class="btn-arrow">‚Üí</span>
                </button>
              </div>

              <!-- VIP Plan -->
              <div class="plan-column vip-plan">
                <div class="plan-header">
                  <div class="plan-icon vip">
                    <span class="material-icons">diamond</span>
                  </div>
                  <h3>VIP</h3>
                  <div class="plan-price">
                    <span class="price">99‚Ç¨</span>
                    <span class="period">/mois</span>
                  </div>
                  <div class="enterprise-badge">Pour les professionnels</div>
                </div>
                
                <div class="plan-features">
                  <div class="feature-category">
                    <h4>Tout Premium +</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Alertes illimit√©es</li>
                      <li><span class="icon check">‚úì</span>API access</li>
                      <li><span class="icon check">‚úì</span>Rapports personnalis√©s</li>
                    </ul>
                  </div>
                  
                  <div class="feature-category">
                    <h4>Service VIP</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Conseiller personnel d√©di√©</li>
                      <li><span class="icon check">‚úì</span>Support t√©l√©phonique 24/7</li>
                      <li><span class="icon check">‚úì</span>Assistance √† la n√©gociation</li>
                    </ul>
                  </div>
                  
                  <div class="feature-category">
                    <h4>Analytics Pro</h4>
                    <ul>
                      <li><span class="icon check">‚úì</span>Tendances de march√© exclusives</li>
                      <li><span class="icon check">‚úì</span>Pr√©visions de prix IA</li>
                      <li><span class="icon check">‚úì</span>Rapports d'investissement</li>
                    </ul>
                  </div>
                </div>
                
                <button class="btn btn-vip-cta" (click)="upgradeToVip()">
                  <span class="material-icons">crown</span>
                  Passer √† VIP
                  <span class="btn-arrow">‚Üí</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Testimonials -->
          <div class="testimonials-section">
            <h3>Ils ont choisi Premium</h3>
            <div class="testimonials-grid">
              <div class="testimonial-card">
                <div class="testimonial-content">
                  <p>"Gr√¢ce √† Premium, j'ai trouv√© mon appartement id√©al en seulement 2 semaines. Les alertes en temps r√©el font toute la diff√©rence !"</p>
                </div>
                <div class="testimonial-author">
                  <div class="author-avatar">MD</div>
                  <div class="author-info">
                    <div class="author-name">Marie Dupont</div>
                    <div class="author-role">Cliente Premium</div>
                  </div>
                </div>
              </div>
              
              <div class="testimonial-card">
                <div class="testimonial-content">
                  <p>"L'acc√®s prioritaire aux nouvelles annonces m'a permis de n√©gocier le meilleur prix pour ma villa √† Sousse."</p>
                </div>
                <div class="testimonial-author">
                  <div class="author-avatar">AB</div>
                  <div class="author-info">
                    <div class="author-name">Ahmed Ben Ali</div>
                    <div class="author-role">Client VIP</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Money Back Guarantee -->
          <div class="guarantee-section">
            <div class="guarantee-content">
              <div class="guarantee-icon">
                <span class="material-icons">verified</span>
              </div>
              <div class="guarantee-text">
                <h4>Garantie satisfait ou rembours√©</h4>
                <p>Pas satisfait dans les 30 premiers jours ? Nous vous remboursons int√©gralement, sans question.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CLIENT_ABONNE Dashboard -->
      <div *ngIf="isClientAbonne()" class="dashboard-content">
        <!-- Overview Section -->
        <div *ngIf="activeSection === 'overview'" class="section-content">
          <!-- Compact Stats Grid -->
          <div class="compact-stats-grid">
            <div class="compact-stat-card" (click)="setActiveSection('searches')">
              <div class="stat-icon primary">
                <span class="material-icons">search</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getClientStats().searchesRemaining || 47 }}</div>
                <div class="stat-label">Recherches restantes</div>
                <div class="stat-sublabel">sur {{ getSubscriptionInfo()?.searchLimit || 50 }}</div>
              </div>
              <div class="stat-action">
                <span class="material-icons">arrow_forward</span>
              </div>
            </div>
            
            <div class="compact-stat-card" (click)="setActiveSection('subscription')">
              <div class="stat-icon success">
                <span class="material-icons">workspace_premium</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getSubscriptionInfo()?.type || 'Premium' }}</div>
                <div class="stat-label">Abonnement actif</div>
                <div class="stat-sublabel">{{ getSubscriptionDaysRemaining() }} jours restants</div>
              </div>
              <div class="stat-action">
                <span class="material-icons">arrow_forward</span>
              </div>
            </div>
            
            <div class="compact-stat-card" (click)="openFavoritesModal()">
              <div class="stat-icon warning">
                <span class="material-icons">favorite</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getClientStats().favoriteProperties || 8 }}</div>
                <div class="stat-label">Biens favoris</div>
                <div class="stat-sublabel">{{ getClientStats().newFavorites || 2 }} nouveaux</div>
              </div>
              <div class="stat-action">
                <span class="material-icons">arrow_forward</span>
              </div>
            </div>
            
            <div class="compact-stat-card" (click)="openAlertsModal()">
              <div class="stat-icon info">
                <span class="material-icons">notifications_active</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getClientStats().activeAlerts || 5 }}</div>
                <div class="stat-label">Alertes actives</div>
                <div class="stat-sublabel">{{ getClientStats().newMatches || 12 }} nouveaux r√©sultats</div>
              </div>
              <div class="stat-action">
                <span class="material-icons">arrow_forward</span>
              </div>
            </div>
          </div>

          <!-- Quick Actions Dashboard -->
          <div class="quick-actions-dashboard">
            <h3>Actions rapides</h3>
            <div class="action-cards-grid">
              <div class="action-card primary" (click)="startQuickSearch()">
                <div class="action-icon">
                  <span class="material-icons">search</span>
                </div>
                <div class="action-content">
                  <h4>Recherche rapide</h4>
                  <p>Trouvez votre bien id√©al</p>
                </div>
                <div class="action-arrow">
                  <span class="material-icons">play_arrow</span>
                </div>
              </div>

              <div class="action-card success" (click)="createAlert()">
                <div class="action-icon">
                  <span class="material-icons">add_alert</span>
                </div>
                <div class="action-content">
                  <h4>Cr√©er une alerte</h4>
                  <p>Soyez notifi√© des nouveaut√©s</p>
                </div>
                <div class="action-arrow">
                  <span class="material-icons">play_arrow</span>
                </div>
              </div>

              <div class="action-card warning" (click)="viewAnalytics()">
                <div class="action-icon">
                  <span class="material-icons">analytics</span>
                </div>
                <div class="action-content">
                  <h4>Mes statistiques</h4>
                  <p>Analysez votre activit√©</p>
                </div>
                <div class="action-arrow">
                  <span class="material-icons">play_arrow</span>
                </div>
              </div>

              <div class="action-card info" (click)="manageSubscription()">
                <div class="action-icon">
                  <span class="material-icons">settings</span>
                </div>
                <div class="action-content">
                  <h4>G√©rer l'abonnement</h4>
                  <p>Facturation et options</p>
                </div>
                <div class="action-arrow">
                  <span class="material-icons">play_arrow</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity Feed -->
          <div class="compact-activity-feed">
            <div class="feed-header">
              <h3>Activit√© r√©cente</h3>
              <button class="btn-link" (click)="setActiveSection('searches')">
                Voir tout
                <span class="material-icons">arrow_forward</span>
              </button>
            </div>
            <div class="activity-timeline">
              <div class="timeline-item" *ngFor="let activity of getRecentClientActivity().slice(0, 4)">
                <div class="timeline-dot" [class]="activity.type">
                  <span class="material-icons">{{ activity.icon }}</span>
                </div>
                <div class="timeline-content">
                  <div class="timeline-title">{{ activity.title }}</div>
                  <div class="timeline-subtitle">{{ activity.description }}</div>
                  <div class="timeline-time">{{ formatRelativeTime(activity.date) }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recommended Properties Widget -->
          <div class="recommendations-widget">
            <div class="widget-header">
              <h3>Recommandations personnalis√©es</h3>
              <button class="btn-link" (click)="setActiveSection('properties')">
                Voir plus
                <span class="material-icons">arrow_forward</span>
              </button>
            </div>
            <div class="compact-properties-grid" *ngIf="!isLoadingRecommendations && recommendedProperties?.length">
              <div class="compact-property-card" 
                   *ngFor="let property of recommendedProperties.slice(0, 3)"
                   (click)="viewAnnonceDetails(property)">
                <div class="property-image">
                  <img *ngIf="property.premierImage" [src]="property.premierImage" [alt]="property.titre">
                  <div *ngIf="!property.premierImage" class="default-image">
                    <span class="material-icons">home</span>
                  </div>
                  <div class="property-badge">{{ getAnnonceTypeTransactionDisplay(property.typeTransaction) }}</div>
                </div>
                <div class="property-info">
                  <h4>{{ property.titre | slice:0:35 }}{{ property.titre.length > 35 ? '...' : '' }}</h4>
                  <div class="property-price">{{ formatPrice(property.prix) }} TND</div>
                  <div class="property-location">
                    <span class="material-icons">location_on</span>
                    {{ property.ville }}
                  </div>
                </div>
              </div>
            </div>
            <div class="loading-recommendations" *ngIf="isLoadingRecommendations">
              <div class="loading-spinner"></div>
              <p>Chargement des recommandations...</p>
            </div>
          </div>

          <!-- Subscription Status Banner -->
          <div class="subscription-banner" [class]="getSubscriptionStatusClass()">
            <div class="banner-content">
              <div class="banner-icon">
                <span class="material-icons">{{ getSubscriptionIcon() }}</span>
              </div>
              <div class="banner-text">
                <h4>{{ getSubscriptionStatusTitle() }}</h4>
                <p>{{ getSubscriptionStatusMessage() }}</p>
              </div>
              <button class="banner-action" (click)="handleSubscriptionAction()">
                {{ getSubscriptionActionText() }}
                <span class="material-icons">arrow_forward</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Properties Browse Section for CLIENT_ABONNE -->
        <div *ngIf="activeSection === 'properties'" class="section-content">
          <div class="properties-header">
            <h2>Parcourir les Biens Immobiliers</h2>
            <p class="premium-notice">
              <span class="material-icons">star</span>
              Acc√®s Premium - Recherche avanc√©e et fonctionnalit√©s compl√®tes
            </p>
          </div>

          <!-- Advanced Search Filters for Premium Users -->
          <div class="advanced-search-filters">
            <div class="filter-row">
              <div class="search-input">
                <span class="material-icons">search</span>
                <input type="text" 
                       placeholder="Rechercher par titre ou localisation..."
                       [(ngModel)]="searchQuery"
                       (input)="searchPublicAnnonces()"
                       class="form-control">
              </div>
              <div class="filter-select">
                <select [(ngModel)]="selectedTypeBien" (change)="searchPublicAnnonces()" class="form-control">
                  <option value="">Tous les types</option>
                  <option value="APPARTEMENT">Appartement</option>
                  <option value="VILLA">Villa</option>
                  <option value="MAISON">Maison</option>
                  <option value="STUDIO">Studio</option>
                  <option value="DUPLEX">Duplex</option>
                  <option value="PENTHOUSE">Penthouse</option>
                  <option value="TERRAIN">Terrain</option>
                </select>
              </div>
              <div class="filter-select">
                <select [(ngModel)]="selectedTypeTransaction" (change)="searchPublicAnnonces()" class="form-control">
                  <option value="">Vente ou Location</option>
                  <option value="VENTE">Vente</option>
                  <option value="LOCATION">Location</option>
                </select>
              </div>
              <button class="btn btn-secondary" (click)="clearSearch()">
                <span class="material-icons">clear</span>
                Effacer
              </button>
              <button class="btn btn-primary" (click)="searchPublicAnnonces()">
                <span class="material-icons">search</span>
                Rechercher
              </button>
            </div>
          </div>

          <!-- Loading State -->
          <div class="loading-section" *ngIf="isLoadingPublicAnnonces">
            <div class="loading-spinner"></div>
            <p>Chargement des annonces...</p>
          </div>

          <!-- Enhanced Properties Grid for Premium Users -->
          <div class="premium-annonce-grid" *ngIf="!isLoadingPublicAnnonces && publicAnnonces?.content?.length">
            <div class="annonce-card premium-card" 
                 *ngFor="let annonce of publicAnnonces?.content; let i = index">
              
              <!-- Main Image Section -->
              <div class="annonce-image-section">
                <div class="main-image-container">
                  <div *ngIf="annonce.premierImage" class="main-image">
                    <img [src]="annonce.premierImage" [alt]="annonce.titre">
                  </div>
                  <div *ngIf="!annonce.premierImage" class="default-image">
                    <span class="material-icons">{{ annonce.typeBien === 'VILLA' ? 'villa' : 'home' }}</span>
                  </div>
                  
                  <!-- Overlay badges -->
                  <div class="image-overlay">
                    <div class="badges">
                      <span class="badge transaction-badge">{{ getAnnonceTypeTransactionDisplay(annonce.typeTransaction) }}</span>
                      <span class="badge type-badge">{{ getAnnonceTypeBienDisplay(annonce.typeBien) }}</span>
                      <span class="badge status-badge status-active">Actif</span>
                    </div>
                    
                    <!-- Rating Display -->
                    <div class="rating-display" *ngIf="annonceRatings[annonce.id]">
                      <div class="rating-stars">
                        <span class="material-icons filled" *ngFor="let star of [1,2,3,4,5]; let j = index" 
                              [class.filled]="j < annonceRatings[annonce.id]">star</span>
                      </div>
                      <span class="rating-value">{{ annonceRatings[annonce.id] | number:'1.1-1' }}</span>
                    </div>

                    <!-- Favorite Button -->
                    <div class="favorite-action">
                      <button class="btn-favorite" (click)="toggleFavorite(annonce); $event.stopPropagation()">
                        <span class="material-icons">favorite_border</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Info Section -->
              <div class="annonce-info-section">
                <!-- Title and Basic Info -->
                <div class="title-section">
                  <h3 class="annonce-title">{{ annonce.titre }}</h3>
                  <div class="basic-info">
                    <span class="price">{{ formatPrice(annonce.prix) }} <span class="currency">TND</span></span>
                  </div>
                </div>

                <!-- Location -->
                <div class="location-section">
                  <div class="location">
                    <span class="material-icons">location_on</span>
                    <span>
                      <ng-container *ngIf="annonce.adresse">{{ annonce.adresse }}, </ng-container>
                      {{ annonce.ville }}
                      <ng-container *ngIf="annonce.codePostal"> {{ annonce.codePostal }}</ng-container>
                    </span>
                  </div>
                </div>

                <!-- Property Features -->
                <div class="features-section">
                  <div class="features-grid">
                    <div class="feature-item" *ngIf="annonce.surface">
                      <span class="material-icons">square_foot</span>
                      <span class="feature-label">Surface</span>
                      <span class="feature-value">{{ annonce.surface }}m¬≤</span>
                    </div>
                    <div class="feature-item" *ngIf="annonce.nombreChambres">
                      <span class="material-icons">bed</span>
                      <span class="feature-label">Chambres</span>
                      <span class="feature-value">{{ annonce.nombreChambres }}</span>
                    </div>
                    <div class="feature-item" *ngIf="annonce.nombreSallesBain">
                      <span class="material-icons">bathtub</span>
                      <span class="feature-label">Salles de bain</span>
                      <span class="feature-value">{{ annonce.nombreSallesBain }}</span>
                    </div>
                    <div class="feature-item" *ngIf="annonce.etage != null">
                      <span class="material-icons">layers</span>
                      <span class="feature-label">√âtage</span>
                      <span class="feature-value">{{ annonce.etage }}</span>
                    </div>
                  </div>
                </div>

                <!-- Amenities -->
                <div class="amenities-section" *ngIf="annonce.garage || annonce.jardin || annonce.piscine || annonce.climatisation || annonce.ascenseur">
                  <div class="amenities-list">
                    <div class="amenity-item" *ngIf="annonce.garage">
                      <span class="material-icons">garage</span>
                      <span>Garage</span>
                    </div>
                    <div class="amenity-item" *ngIf="annonce.jardin">
                      <span class="material-icons">grass</span>
                      <span>Jardin</span>
                    </div>
                    <div class="amenity-item" *ngIf="annonce.piscine">
                      <span class="material-icons">pool</span>
                      <span>Piscine</span>
                    </div>
                    <div class="amenity-item" *ngIf="annonce.climatisation">
                      <span class="material-icons">ac_unit</span>
                      <span>Climatisation</span>
                    </div>
                    <div class="amenity-item" *ngIf="annonce.ascenseur">
                      <span class="material-icons">elevator</span>
                      <span>Ascenseur</span>
                    </div>
                  </div>
                </div>

                <!-- Contact Information -->
                <div class="contact-section">
                  <div class="contact-info">
                    <div class="contact-item">
                      <span class="material-icons">business</span>
                      <span>{{ annonce.createurNom }}</span>
                    </div>
                  </div>
                </div>

                <!-- Actions -->
                <div class="actions-section">
                  <div class="action-buttons">
                    <button class="btn btn-outline" (click)="viewAnnonceDetails(annonce)">
                      <span class="material-icons">visibility</span>
                      Voir D√©tails
                    </button>
                    
                    <button class="btn btn-primary" (click)="openCommentModal(annonce)">
                      <span class="material-icons">comment</span>
                      Commenter
                    </button>
                    
                    <button class="btn btn-secondary" (click)="editAnnonce(annonce)">
                      <span class="material-icons">edit</span>
                      √âvaluer
                    </button>
                  </div>

                  <!-- Stats -->
                  <div class="stats-section">
                    <div class="stat-item">
                      <span class="material-icons">visibility</span>
                      <span>{{ annonce.vues }}</span>
                    </div>
                    <div class="stat-item">
                      <span class="material-icons">favorite</span>
                      <span>{{ annonce.favoris }}</span>
                    </div>
                    <div class="stat-item">
                      <span class="material-icons">comment</span>
                      <span>{{ annonceComments[annonce.id]?.length || 0 }}</span>
                    </div>
                  </div>
                </div>

                <!-- Metadata -->
                <div class="metadata-section">
                  <div class="metadata-item">
                    <span class="label">Publi√© le:</span>
                    <span class="value">{{ formatDate(annonce.dateCreation) }}</span>
                  </div>
                  <div class="metadata-item" *ngIf="annonce.dateMiseAJour">
                    <span class="label">Modifi√© le:</span>
                    <span class="value">{{ formatDate(annonce.dateMiseAJour) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- No Results -->
          <div class="no-results" *ngIf="!isLoadingPublicAnnonces && (!publicAnnonces?.content?.length)">
            <div class="no-results-content">
              <span class="material-icons">search_off</span>
              <h3>Aucune annonce trouv√©e</h3>
              <p>Essayez de modifier vos crit√®res de recherche</p>
            </div>
          </div>

          <!-- Enhanced Pagination -->
          <div class="pagination premium-pagination" *ngIf="publicAnnonces && publicAnnonces.totalPages > 1">
            <button class="btn btn-pagination" 
                    [disabled]="!publicAnnonces.hasPrevious"
                    (click)="loadPublicAnnonces(publicAnnonces.currentPage - 1)">
              <span class="material-icons">chevron_left</span>
              Pr√©c√©dent
            </button>
            
            <div class="pagination-pages">
              <button *ngFor="let page of getPaginationPages()" 
                      class="btn btn-page"
                      [class.active]="page === publicAnnonces.currentPage"
                      (click)="loadPublicAnnonces(page)">
                {{ page + 1 }}
              </button>
            </div>
            
            <span class="pagination-info">
              Affichage {{ (publicAnnonces.currentPage * publicAnnonces.size) + 1 }} √†  
              {{ Math.min((publicAnnonces.currentPage + 1) * publicAnnonces.size, publicAnnonces.totalElements) }} 
              sur {{ publicAnnonces.totalElements }} r√©sultats
            </span>
            
            <button class="btn btn-pagination" 
                    [disabled]="!publicAnnonces.hasNext"
                    (click)="loadPublicAnnonces(publicAnnonces.currentPage + 1)">
              Suivant
              <span class="material-icons">chevron_right</span>
            </button>
          </div>
        </div>

        <!-- Subscription Section -->
        <div *ngIf="activeSection === 'subscription'" class="section-content">
          <div class="subscription-header">
            <h2>Gestion de l'Abonnement</h2>
            <p>G√©rez votre abonnement et d√©couvrez les fonctionnalit√©s disponibles</p>
          </div>

          <div class="subscription-card current">
            <div class="subscription-header-card">
              <div class="subscription-icon">
                <span class="material-icons">{{ getSubscriptionInfo()?.type === 'VIP' ? 'diamond' : 'star' }}</span>
              </div>
              <div class="subscription-info">
                <h3>Abonnement {{ getSubscriptionInfo()?.type }}</h3>
                <p class="subscription-status active">Actif</p>
              </div>
              <div class="subscription-actions">
                <button class="btn btn-outline">Modifier</button>
                <button class="btn btn-secondary">Facturation</button>
              </div>
            </div>
            
            <div class="subscription-details-grid">
              <div class="detail-card">
                <span class="material-icons">search</span>
                <div class="detail-content">
                  <div class="detail-number">{{ getSubscriptionInfo()?.searchLimit || 'Illimit√©es' }}</div>
                  <div class="detail-label">Recherches / mois</div>
                </div>
              </div>
              <div class="detail-card">
                <span class="material-icons">event</span>
                <div class="detail-content">
                  <div class="detail-number">{{ getSubscriptionInfo()?.endDate | date:'dd/MM' || '--' }}</div>
                  <div class="detail-label">Prochain renouvellement</div>
                </div>
              </div>
              <div class="detail-card">
                <span class="material-icons">euro</span>
                <div class="detail-content">
                  <div class="detail-number">{{ getSubscriptionInfo()?.type === 'VIP' ? '99‚Ç¨' : '29‚Ç¨' }}</div>
                  <div class="detail-label">Prix mensuel</div>
                </div>
              </div>
              <div class="detail-card">
                <span class="material-icons">support</span>
                <div class="detail-content">
                  <div class="detail-number">{{ getSubscriptionInfo()?.type === 'VIP' ? '24/7' : 'Email' }}</div>
                  <div class="detail-label">Support</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Subscription Plans Upgrade -->
          <div class="upgrade-plans">
            <h3>Upgrader votre abonnement</h3>
            <div class="plans-comparison">
              <div class="plan-card premium" [class.current]="getSubscriptionInfo()?.type === 'PREMIUM'">
                <div class="plan-header">
                  <h4>Premium</h4>
                  <div class="plan-price">29‚Ç¨<span>/mois</span></div>
                </div>
                <ul class="plan-features">
                  <li><span class="material-icons">check</span>50 recherches par mois</li>
                  <li><span class="material-icons">check</span>Alertes personnalis√©es</li>
                  <li><span class="material-icons">check</span>Favoris illimit√©s</li>
                  <li><span class="material-icons">check</span>Support email</li>
                  <li><span class="material-icons">check</span>Statistiques de recherche</li>
                </ul>
                <button class="btn" [class]="getSubscriptionInfo()?.type === 'PREMIUM' ? 'btn-current' : 'btn-premium'" 
                        [disabled]="getSubscriptionInfo()?.type === 'PREMIUM'">
                  {{ getSubscriptionInfo()?.type === 'PREMIUM' ? 'Actuel' : 'Passer √† Premium' }}
                </button>
              </div>

              <div class="plan-card vip" [class.current]="getSubscriptionInfo()?.type === 'VIP'">
                <div class="plan-header">
                  <div class="popular-badge">Plus populaire</div>
                  <h4>VIP</h4>
                  <div class="plan-price">99‚Ç¨<span>/mois</span></div>
                </div>
                <ul class="plan-features">
                  <li><span class="material-icons">check</span>Recherches illimit√©es</li>
                  <li><span class="material-icons">check</span>Alertes en temps r√©el</li>
                  <li><span class="material-icons">check</span>Acc√®s prioritaire aux nouveaut√©s</li>
                  <li><span class="material-icons">check</span>Conseiller personnel d√©di√©</li>
                  <li><span class="material-icons">check</span>Support t√©l√©phonique 24/7</li>
                  <li><span class="material-icons">check</span>Analytics avanc√©es</li>
                </ul>
                <button class="btn" [class]="getSubscriptionInfo()?.type === 'VIP' ? 'btn-current' : 'btn-vip'"
                        [disabled]="getSubscriptionInfo()?.type === 'VIP'">
                  {{ getSubscriptionInfo()?.type === 'VIP' ? 'Actuel' : 'Passer √† VIP' }}
                </button>
              </div>
            </div>
          </div>

          <!-- Usage Statistics -->
          <div class="usage-stats">
            <h3>Utilisation ce mois</h3>
            <div class="usage-grid">
              <div class="usage-item">
                <div class="usage-bar">
                  <div class="usage-progress" style="width: 60%"></div>
                </div>
                <div class="usage-info">
                  <span class="usage-label">Recherches utilis√©es</span>
                  <span class="usage-value">30 / {{ getSubscriptionInfo()?.searchLimit || '50' }}</span>
                </div>
              </div>
              <div class="usage-item">
                <div class="usage-bar">
                  <div class="usage-progress" style="width: 80%"></div>
                </div>
                <div class="usage-info">
                  <span class="usage-label">Alertes actives</span>
                  <span class="usage-value">8 / 10</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Searches Section -->
        <div *ngIf="activeSection === 'searches'" class="section-content">
          <div class="searches-header">
            <h2>Mes Recherches & Alertes</h2>
            <button class="btn btn-primary">
              <span class="material-icons">add</span>
              Nouvelle recherche
            </button>
          </div>

          <!-- Search History -->
          <div class="search-history">
            <h3>Historique des recherches</h3>
            <div class="search-list">
              <div class="search-item">
                <div class="search-info">
                  <div class="search-title">Appartement 3 pi√®ces - Tunis Centre</div>
                  <div class="search-details">
                    <span class="search-criteria">Budget: 150k-250k ‚Ç¨ ‚Ä¢ 3 pi√®ces ‚Ä¢ Tunis</span>
                    <span class="search-date">Recherch√© le 28/01/2025</span>
                  </div>
                </div>
                <div class="search-actions">
                  <button class="btn btn-sm btn-outline">
                    <span class="material-icons">refresh</span>
                    Relancer
                  </button>
                  <button class="btn btn-sm btn-primary">
                    <span class="material-icons">notifications</span>
                    Cr√©er une alerte
                  </button>
                </div>
              </div>

              <div class="search-item">
                <div class="search-info">
                  <div class="search-title">Villa avec jardin - Sousse</div>
                  <div class="search-details">
                    <span class="search-criteria">Budget: 300k-500k ‚Ç¨ ‚Ä¢ Villa ‚Ä¢ Sousse</span>
                    <span class="search-date">Recherch√© le 25/01/2025</span>
                  </div>
                </div>
                <div class="search-actions">
                  <button class="btn btn-sm btn-outline">
                    <span class="material-icons">refresh</span>
                    Relancer
                  </button>
                  <button class="btn btn-sm btn-primary">
                    <span class="material-icons">notifications</span>
                    Cr√©er une alerte
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Active Alerts -->
          <div class="active-alerts">
            <h3>Alertes actives <span class="alert-count">3</span></h3>
            <div class="alert-list">
              <div class="alert-item">
                <div class="alert-info">
                  <div class="alert-title">Appartements Tunis Centre</div>
                  <div class="alert-criteria">Budget: 100k-200k ‚Ç¨ ‚Ä¢ 2-3 pi√®ces</div>
                  <div class="alert-stats">
                    <span class="alert-matches">5 nouveaux biens cette semaine</span>
                    <span class="alert-created">Cr√©√©e le 20/01/2025</span>
                  </div>
                </div>
                <div class="alert-actions">
                  <button class="btn btn-sm btn-outline">Modifier</button>
                  <button class="btn btn-sm btn-secondary">Suspendre</button>
                  <button class="btn btn-sm btn-danger">Supprimer</button>
                </div>
              </div>

              <div class="alert-item">
                <div class="alert-info">
                  <div class="alert-title">Maisons Sfax</div>
                  <div class="alert-criteria">Budget: 200k-350k ‚Ç¨ ‚Ä¢ Maison individuelle</div>
                  <div class="alert-stats">
                    <span class="alert-matches">2 nouveaux biens cette semaine</span>
                    <span class="alert-created">Cr√©√©e le 18/01/2025</span>
                  </div>
                </div>
                <div class="alert-actions">
                  <button class="btn btn-sm btn-outline">Modifier</button>
                  <button class="btn btn-sm btn-secondary">Suspendre</button>
                  <button class="btn btn-sm btn-danger">Supprimer</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Saved Searches -->
          <div class="saved-searches">
            <h3>Recherches sauvegard√©es</h3>
            <div class="saved-list">
              <div class="saved-item">
                <span class="material-icons">bookmark</span>
                <div class="saved-content">
                  <div class="saved-title">Mon premier achat</div>
                  <div class="saved-criteria">Appartement ‚Ä¢ Tunis ‚Ä¢ 80-120k</div>
                </div>
                <button class="btn btn-sm btn-primary">Rechercher</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Section -->
        <div *ngIf="activeSection === 'analytics'" class="section-content">
          <div class="analytics-header">
            <h2>Mes Statistiques</h2>
            <p>Analysez votre activit√© sur la plateforme</p>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoadingAnalytics" class="loading-container">
            <div class="spinner"></div>
            <p>Chargement des donn√©es analytiques...</p>
          </div>

          <!-- Key Metrics -->
          <div *ngIf="!isLoadingAnalytics && analyticsData" class="analytics-metrics">
            <div *ngFor="let metric of analyticsData.keyMetrics" 
                 class="metric-card animated-metric-card"
                 (click)="showMetricDetails(metric)">
              <div class="metric-icon">
                <span class="material-icons" [style.color]="metric.color">{{ metric.icon }}</span>
              </div>
              <div class="metric-content">
                <div class="metric-number">{{ metric.value }}</div>
                <div class="metric-label">{{ metric.label }}</div>
                <div class="metric-trend" [ngClass]="metric.trend">
                  <span class="material-icons">
                    {{ metric.trend === 'positive' ? 'trending_up' : 
                       metric.trend === 'negative' ? 'trending_down' : 'trending_flat' }}
                  </span>
                  {{ metric.percentage ? '+' + metric.percentage + '%' : 'Stable' }}
                </div>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div *ngIf="!isLoadingAnalytics && analyticsData" class="analytics-charts">
            <div *ngFor="let chart of analyticsData.charts" class="chart-grid-item">
              <app-animated-chart 
                [chartData]="chart"
                [showLegend]="true"
                [animated]="true"
                [responsive]="true">
              </app-animated-chart>
            </div>
          </div>

          <!-- Preferences Analysis -->
          <div class="preferences-analysis">
            <h3>Analyse de vos pr√©f√©rences</h3>
            <div class="preference-list">
              <div class="preference-item">
                <span class="preference-label">Budget moyen recherch√©</span>
                <span class="preference-value">180 000 ‚Ç¨</span>
              </div>
              <div class="preference-item">
                <span class="preference-label">Type de bien pr√©f√©r√©</span>
                <span class="preference-value">Appartement (68%)</span>
              </div>
              <div class="preference-item">
                <span class="preference-label">Ville la plus recherch√©e</span>
                <span class="preference-value">Tunis</span>
              </div>
              <div class="preference-item">
                <span class="preference-label">Taille id√©ale</span>
                <span class="preference-value">3 pi√®ces</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Mes Annonces Section for CLIENT_ABONNE -->
        <div *ngIf="activeSection === 'mes-annonces'" class="section-content">
          <div class="properties-header">
            <h2>Mes Annonces</h2>
            <p class="premium-notice">
              <span class="material-icons">star</span>
              En tant qu'abonn√© Premium, vous pouvez cr√©er et g√©rer vos propres annonces
            </p>
            <button class="btn btn-primary" (click)="createNewAnnonce()">
              <span class="material-icons">add</span>
              Nouvelle annonce
            </button>
          </div>

          <!-- Annonces Stats for CLIENT_ABONNE -->
          <div class="properties-stats">
            <div class="stat-row">
              <div class="stat-item">
                <span class="stat-number">{{ getTotalAnnonces() }}</span>
                <span class="stat-label">Total annonces</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getActiveAnnonces() }}</span>
                <span class="stat-label">Actives</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getTotalVues() }}</span>
                <span class="stat-label">Vues totales</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getTotalFavoris() }}</span>
                <span class="stat-label">Favoris</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ formatPrice(getPrixMoyen()) }}</span>
                <span class="stat-label">Prix moyen</span>
              </div>
            </div>
          </div>

          <!-- Search and Filters for CLIENT_ABONNE -->
          <div class="properties-filters">
            <div class="filters-row">
              <div class="form-group">
                <label>Rechercher</label>
                <input 
                  type="text" 
                  placeholder="Rechercher par titre, ville..." 
                  [(ngModel)]="searchQuery"
                  (input)="onSearch()"
                  (keyup)="onSearch()"
                  class="search-input"
                >
              </div>
              <div class="form-group">
                <label>Type de bien</label>
                <select [(ngModel)]="selectedTypeBien" (change)="onFilterChange()">
                  <option value="">Tous les types</option>
                  <option value="VILLA">Villa</option>
                  <option value="APPARTEMENT">Appartement</option>
                  <option value="MAISON">Maison</option>
                  <option value="STUDIO">Studio</option>
                  <option value="DUPLEX">Duplex</option>
                  <option value="PENTHOUSE">Penthouse</option>
                  <option value="TERRAIN">Terrain</option>
                  <option value="LOCAL_COMMERCIAL">Local Commercial</option>
                  <option value="BUREAU">Bureau</option>
                  <option value="ENTREPOT">Entrep√¥t</option>
                </select>
              </div>
              <div class="form-group">
                <label>Transaction</label>
                <select [(ngModel)]="selectedTypeTransaction" (change)="onFilterChange()">
                  <option value="">Toutes</option>
                  <option value="VENTE">Vente</option>
                  <option value="LOCATION">Location</option>
                </select>
              </div>
              <div class="form-group">
                <label>Statut</label>
                <select [(ngModel)]="selectedStatus" (change)="onFilterChange()">
                  <option value="">Tous les statuts</option>
                  <option value="DISPONIBLE">Disponible</option>
                  <option value="VENDU">Vendu</option>
                  <option value="LOUE">Lou√©</option>
                  <option value="RESERVE">R√©serv√©</option>
                  <option value="EXPIRE">Expir√©</option>
                  <option value="SUSPENDU">Suspendu</option>
                </select>
              </div>
              <button class="btn-search" (click)="searchAnnonces()">
                <span class="material-icons">search</span>
                Rechercher
              </button>
            </div>
          </div>

          <!-- CLIENT_ABONNE Annonces List -->
          <div>
            <!-- Loading state -->
            <div *ngIf="isLoadingAnnonces" class="loading-state">
              <div class="loading-spinner"></div>
              <p>Chargement de vos annonces...</p>
            </div>

            <!-- No annonces state -->
            <div *ngIf="!isLoadingAnnonces && (!myAnnonces || !myAnnonces.content || myAnnonces.content.length === 0)" class="empty-state">
              <div class="empty-icon">
                <span class="material-icons">home_work</span>
              </div>
              <h3>Aucune annonce trouv√©e</h3>
              <p>Vous n'avez pas encore cr√©√© d'annonce. En tant qu'abonn√© Premium, vous pouvez cr√©er et g√©rer vos annonces !</p>
              <button class="btn btn-primary" (click)="createNewAnnonce()">
                <span class="material-icons">add</span>
                Cr√©er ma premi√®re annonce
              </button>
            </div>

            <!-- Annonces grid container -->
            <div *ngIf="!isLoadingAnnonces && myAnnonces && myAnnonces.content && myAnnonces.content.length > 0" 
                 class="properties-list">
              
              <!-- Individual property cards for CLIENT_ABONNE -->
              <div class="annonce-card premium-card" *ngFor="let annonce of myAnnonces.content">
                <div class="annonce-image-section">
                  <div class="main-image-container">
                    <div *ngIf="!annonce.premierImage" class="default-image">
                      <span class="material-icons" style="font-size: 3rem; color: #94a3b8;">{{ annonce.typeBien === 'VILLA' ? 'villa' : 'home' }}</span>
                    </div>
                    <img *ngIf="annonce.premierImage" [src]="annonce.premierImage" [alt]="annonce.titre" class="main-image">
                  </div>
                  
                  <div class="image-overlay">
                    <div class="badges">
                      <div class="badge transaction">{{ getAnnonceTypeTransactionDisplay(annonce.typeTransaction) }}</div>
                      <div class="badge type">{{ getAnnonceTypeBienDisplay(annonce.typeBien) }}</div>
                      <div class="badge status" [ngClass]="'status-' + annonce.status.toLowerCase()">
                        {{ getAnnonceStatusDisplay(annonce.status) }}
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="annonce-info-section">
                  <div class="title-section">
                    <h3 class="annonce-title">{{ annonce.titre }}</h3>
                    
                    <!-- Creator Information for CLIENT_ABONNE -->
                    <div class="creator-info" *ngIf="annonce.createurType && annonce.createurNom">
                      <div class="creator-badge creator-client_abonne">
                        <span class="material-icons">person</span>
                        <span class="creator-text">Client Premium</span>
                      </div>
                      <div class="creator-name">{{ annonce.createurNom }} {{ annonce.createurPrenom || '' }}</div>
                    </div>
                  </div>
                  
                  <div class="location-section">
                    <span class="material-icons">location_on</span>
                    <ng-container *ngIf="annonce.adresse">{{ annonce.adresse }}, </ng-container>{{ annonce.ville }}<ng-container *ngIf="annonce.codePostal"> {{ annonce.codePostal }}</ng-container>
                  </div>
                  
                  <div class="description-section" *ngIf="annonce.description">
                    {{ annonce.description }}
                  </div>
                  
                  <div class="features-section">
                    <div class="features-grid">
                    <div class="feature-item" *ngIf="annonce.nombreChambres">
                      <span class="material-icons">bed</span>
                      {{ annonce.nombreChambres }} chambres
                    </div>
                    <div class="feature-item" *ngIf="annonce.nombreSallesBain">
                      <span class="material-icons">bathtub</span>
                      {{ annonce.nombreSallesBain }} SDB
                    </div>
                    <div class="feature-item" *ngIf="annonce.surface">
                      <span class="material-icons">square_foot</span>
                      {{ annonce.surface }}m¬≤
                    </div>
                    <div class="feature-item" *ngIf="annonce.etage != null">
                      <span class="material-icons">layers</span>
                      √âtage {{ annonce.etage }}
                    </div>
                    </div>
                  </div>
                  
                  <div class="footer-section">
                    <div class="price-section">
                      {{ formatPrice(annonce.prix) }}
                      <span class="currency">TND</span>
                    </div>
                    
                    <!-- Action buttons with permission checks for CLIENT_ABONNE -->
                    <div class="actions-section">
                      <button class="btn-action" (click)="viewAnnonce(annonce.id)" title="Voir les d√©tails">
                        <span class="material-icons">visibility</span>
                      </button>
                      <!-- CLIENT_ABONNE can edit/delete only their own annonces -->
                      <button *ngIf="currentUser && (annonce.createurId === currentUser.id || !annonce.createurId)"
                              class="btn-action btn-edit" (click)="editAnnonce(annonce.id)" title="Modifier">
                        <span class="material-icons">edit</span>
                      </button>
                      <button *ngIf="currentUser && (annonce.createurId === currentUser.id || !annonce.createurId)"
                              class="btn-action btn-delete" (click)="deleteAnnonce(annonce.id)" title="Supprimer">
                        <span class="material-icons">delete</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pagination -->
            <div class="pagination-container" *ngIf="myAnnonces && myAnnonces.totalPages && myAnnonces.totalPages > 1">
              <div class="pagination">
                <button class="pagination-btn" [disabled]="!myAnnonces.hasPrevious" (click)="goToPage(myAnnonces.currentPage - 1)">
                  <span class="material-icons">chevron_left</span>
                </button>
                
                <button 
                  class="pagination-btn" 
                  [class.active]="page === myAnnonces.currentPage"
                  *ngFor="let page of getPaginationPages()" 
                  (click)="goToPage(page)">
                  {{ page + 1 }}
                </button>
                
                <button class="pagination-btn" [disabled]="!myAnnonces.hasNext" (click)="goToPage(myAnnonces.currentPage + 1)">
                  <span class="material-icons">chevron_right</span>
                </button>
                
                <div class="pagination-info">
                  Page {{ myAnnonces.currentPage + 1 }} sur {{ myAnnonces.totalPages }}
                  <br>
                  {{ myAnnonces.totalElements }} annonces au total
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Section -->
        <div *ngIf="activeSection === 'profile'" class="section-content profile-section">
          <!-- Profile Header -->
          <div class="profile-section-header" *ngIf="!isEditingProfile">
            <div class="section-title">
              <h2>Mon Profil</h2>
              <p>G√©rez vos informations personnelles et votre abonnement</p>
            </div>
            <button class="btn btn-primary" (click)="startEditProfile()">
              <span class="material-icons">edit</span>
              Modifier mes informations
            </button>
          </div>

          <!-- Profile View Mode -->
          <div *ngIf="!isEditingProfile">
            <app-profile-view [user]="currentUser"></app-profile-view>
          </div>

          <!-- Profile Edit Mode -->
          <div *ngIf="isEditingProfile">
            <app-profile-sections 
              [user]="currentUser"
              (saved)="onProfileSaved($event)"
              (cancelled)="cancelEditProfile()"
              (passwordChanged)="onPasswordChanged()">
            </app-profile-sections>
          </div>
        </div>
      </div>

      <!-- AGENCE_IMMOBILIERE Dashboard -->
      <div *ngIf="isAgency()" class="dashboard-content">
        <!-- Overview Section -->
        <div *ngIf="activeSection === 'overview'" class="section-content">
          <!-- Agency Business Header -->
          <div class="business-header">
            <div class="business-info">
              <div class="agency-logo">
                <span class="material-icons">business</span>
              </div>
              <div class="agency-details">
                <h1>{{ getAgencyInfo()?.nomAgence || 'Mon Agence Immobili√®re' }}</h1>
                <p>{{ getAgencyInfo()?.zonesCouverture || 'Tunis, Sousse, Sfax' }}</p>
                <div class="agency-meta">
                  <span class="meta-item">
                    <span class="material-icons">badge</span>
                    Licence: {{ getAgencyInfo()?.numeroLicence || 'TN-2024-001' }}
                  </span>
                  <span class="meta-item" *ngIf="getAgencyInfo()?.siteWeb">
                    <span class="material-icons">language</span>
                    {{ getAgencyInfo()?.siteWeb }}
                  </span>
                </div>
              </div>
            </div>
            <div class="verification-status">
              <div class="status-card" [class]="isAgencyVerified() ? 'verified' : 'pending'">
                <div class="status-icon">
                  <span class="material-icons">{{ isAgencyVerified() ? 'verified' : 'schedule' }}</span>
                </div>
                <div class="status-content">
                  <h3>{{ isAgencyVerified() ? 'Agence V√©rifi√©e' : 'V√©rification en cours' }}</h3>
                  <p>{{ getVerificationStatusMessage() }}</p>
                  <button class="status-action" (click)="manageVerification()" *ngIf="!isAgencyVerified()">
                    Voir le statut
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Business KPI Dashboard -->
          <div class="business-kpi-grid">
            <div class="kpi-card revenue" (click)="openRevenueDetails()">
              <div class="kpi-header">
                <div class="kpi-icon">
                  <span class="material-icons">trending_up</span>
                </div>
                <div class="kpi-trend positive">
                  <span class="material-icons">arrow_upward</span>
                  +12%
                </div>
              </div>
              <div class="kpi-content">
                <div class="kpi-number">{{ getAgencyKPIs().monthlyRevenue || '87,450' }} DT</div>
                <div class="kpi-label">Chiffre d'affaires</div>
                <div class="kpi-subtitle">Ce mois</div>
              </div>
            </div>

            <div class="kpi-card properties" (click)="setActiveSection('properties')">
              <div class="kpi-header">
                <div class="kpi-icon">
                  <span class="material-icons">home</span>
                </div>
                <div class="kpi-trend">
                  <span class="kpi-badge active">{{ getAgencyKPIs().activeProperties || 42 }} actifs</span>
                </div>
              </div>
              <div class="kpi-content">
                <div class="kpi-number">{{ getAgencyKPIs().totalProperties || 127 }}</div>
                <div class="kpi-label">Biens g√©r√©s</div>
                <div class="kpi-subtitle">{{ getAgencyKPIs().newThisWeek || 5 }} nouveaux cette semaine</div>
              </div>
            </div>

            <div class="kpi-card clients" (click)="setActiveSection('clients')">
              <div class="kpi-header">
                <div class="kpi-icon">
                  <span class="material-icons">people</span>
                </div>
                <div class="kpi-trend">
                  <span class="kpi-badge leads">{{ getAgencyKPIs().newLeads || 8 }} leads</span>
                </div>
              </div>
              <div class="kpi-content">
                <div class="kpi-number">{{ getAgencyKPIs().totalClients || 156 }}</div>
                <div class="kpi-label">Clients</div>
                <div class="kpi-subtitle">{{ getAgencyKPIs().activeClients || 89 }} actifs</div>
              </div>
            </div>

            <div class="kpi-card team" (click)="setActiveSection('team')">
              <div class="kpi-header">
                <div class="kpi-icon">
                  <span class="material-icons">group</span>
                </div>
                <div class="kpi-trend positive">
                  <span class="material-icons">star</span>
                  4.8
                </div>
              </div>
              <div class="kpi-content">
                <div class="kpi-number">{{ getAgencyInfo()?.nombreEmployes || 12 }}</div>
                <div class="kpi-label">√âquipe</div>
                <div class="kpi-subtitle">Performance excellente</div>
              </div>
            </div>
          </div>

          <!-- Quick Business Actions -->
          <div class="business-actions">
            <h3>Actions rapides</h3>
            <div class="action-buttons-grid">
              <button class="action-btn primary" (click)="addNewProperty()">
                <div class="btn-icon">
                  <span class="material-icons">add_home</span>
                </div>
                <div class="btn-content">
                  <h4>Nouvelle annonce</h4>
                  <p>Ajouter un bien</p>
                </div>
              </button>

              <button class="action-btn success" (click)="addNewClient()">
                <div class="btn-icon">
                  <span class="material-icons">person_add</span>
                </div>
                <div class="btn-content">
                  <h4>Nouveau client</h4>
                  <p>Ajouter au CRM</p>
                </div>
              </button>

              <button class="action-btn warning" (click)="viewAnalytics()">
                <div class="btn-icon">
                  <span class="material-icons">analytics</span>
                </div>
                <div class="btn-content">
                  <h4>Analytics</h4>
                  <p>Voir rapports</p>
                </div>
              </button>

              <button class="action-btn info" (click)="manageTeam()">
                <div class="btn-icon">
                  <span class="material-icons">manage_accounts</span>
                </div>
                <div class="btn-content">
                  <h4>G√©rer √©quipe</h4>
                  <p>RH et performance</p>
                </div>
              </button>
            </div>
          </div>

          <!-- Business Activity Timeline -->
          <div class="business-timeline">
            <div class="timeline-header">
              <h3>Activit√© commerciale</h3>
              <button class="btn-link" (click)="viewAllActivity()">
                Tout voir
                <span class="material-icons">arrow_forward</span>
              </button>
            </div>
            <div class="timeline-list">
              <div class="timeline-item" *ngFor="let activity of getAgencyActivity().slice(0, 5)">
                <div class="timeline-dot" [class]="activity.type">
                  <span class="material-icons">{{ activity.icon }}</span>
                </div>
                <div class="timeline-content">
                  <div class="timeline-title">{{ activity.title }}</div>
                  <div class="timeline-subtitle">{{ activity.description }}</div>
                  <div class="timeline-meta">
                    <span class="timeline-time">{{ formatRelativeTime(activity.date) }}</span>
                    <span class="timeline-amount" *ngIf="activity.amount">{{ activity.amount }}</span>
                  </div>
                </div>
                <button class="timeline-action" (click)="viewActivityDetails(activity)" *ngIf="activity.actionable">
                  <span class="material-icons">arrow_forward</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Team Performance Preview -->
          <div class="team-preview" *ngIf="isAgencyVerified()">
            <div class="preview-header">
              <h3>Performance √©quipe</h3>
              <button class="btn-link" (click)="setActiveSection('team')">
                G√©rer l'√©quipe
                <span class="material-icons">arrow_forward</span>
              </button>
            </div>
            <div class="team-members-grid">
              <div class="member-card" *ngFor="let member of getTopPerformers().slice(0, 3)">
                <div class="member-avatar">
                  {{ member.initials }}
                </div>
                <div class="member-info">
                  <h4>{{ member.name }}</h4>
                  <p>{{ member.role }}</p>
                  <div class="member-stats">
                    <span class="stat">{{ member.sales }} ventes</span>
                    <span class="stat">{{ member.revenue }} DT</span>
                  </div>
                </div>
                <div class="member-score" [class]="member.performance">
                  {{ member.score }}%
                </div>
              </div>
            </div>
          </div>

          <!-- Market Insights Widget -->
          <div class="market-insights">
            <div class="insights-header">
              <div class="insights-icon">
                <span class="material-icons">trending_up</span>
              </div>
              <div class="insights-content">
                <h3>Tendances du march√©</h3>
                <p>{{ getCurrentMarketTrend() }}</p>
              </div>
              <button class="insights-action" (click)="viewMarketAnalysis()">
                <span class="material-icons">analytics</span>
                Analyser
              </button>
            </div>
            <div class="insights-stats">
              <div class="insight-item">
                <span class="insight-label">Prix m¬≤ moyen</span>
                <span class="insight-value">2,450 DT</span>
                <span class="insight-change positive">+3.2%</span>
              </div>
              <div class="insight-item">
                <span class="insight-label">Temps de vente</span>
                <span class="insight-value">67 jours</span>
                <span class="insight-change negative">-8 jours</span>
              </div>
            </div>
          </div>

          <!-- Notification Center -->
          <div class="notification-center" *ngIf="getAgencyNotifications().length > 0">
            <div class="notification-header">
              <h3>Notifications importantes</h3>
              <span class="notification-count">{{ getAgencyNotifications().length }}</span>
            </div>
            <div class="notification-list">
              <div class="notification-item" 
                   *ngFor="let notification of getAgencyNotifications().slice(0, 3)"
                   [class]="notification.priority">
                <div class="notification-icon">
                  <span class="material-icons">{{ notification.icon }}</span>
                </div>
                <div class="notification-content">
                  <div class="notification-title">{{ notification.title }}</div>
                  <div class="notification-message">{{ notification.message }}</div>
                </div>
                <button class="notification-action" (click)="handleNotification(notification)">
                  {{ notification.actionText }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Annonces Section -->
        <div *ngIf="activeSection === 'properties'" class="section-content">
          <div class="properties-header">
            <h2>Mes Annonces</h2>
            <button class="btn btn-primary" [disabled]="!isAgencyVerified()" (click)="createNewAnnonce()">
              <span class="material-icons">add</span>
              Nouvelle annonce
            </button>
          </div>

          <!-- Non-verified agency message -->
          <div *ngIf="!isAgencyVerified()" class="verification-notice">
            <div class="notice-card">
              <div class="notice-icon">
                <span class="material-icons">info</span>
              </div>
              <div class="notice-content">
                <h3>V√©rification requise</h3>
                <p>Pour acc√©der √† la gestion de vos biens, votre agence doit √™tre v√©rifi√©e par notre √©quipe.</p>
                <p>Une fois la v√©rification termin√©e, vous pourrez:</p>
                <ul>
                  <li>Ajouter et g√©rer vos propri√©t√©s</li>
                  <li>Publier des annonces</li>
                  <li>Acc√©der aux statistiques avanc√©es</li>
                  <li>G√©rer votre portefeuille client</li>
                </ul>
                <button class="btn btn-outline" (click)="setActiveSection('verification')">
                  <span class="material-icons">verified</span>
                  Voir le statut de v√©rification
                </button>
              </div>
            </div>
          </div>

          <!-- Annonces Stats -->
          <div class="properties-stats" *ngIf="isAgencyVerified()">
            <div class="stat-row">
              <div class="stat-item">
                <span class="stat-number">{{ getTotalAnnonces() }}</span>
                <span class="stat-label">Total annonces</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getActiveAnnonces() }}</span>
                <span class="stat-label">Actives</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getTotalVues() }}</span>
                <span class="stat-label">Vues totales</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ getTotalFavoris() }}</span>
                <span class="stat-label">Favoris</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ formatPrice(getPrixMoyen()) }}</span>
                <span class="stat-label">Prix moyen</span>
              </div>
            </div>
          </div>

          <!-- Search and Filters -->
          <div class="properties-filters" *ngIf="isAgencyVerified()">
            <div class="filters-row">
              <div class="form-group">
                <label>Rechercher</label>
                <input 
                  type="text" 
                  placeholder="Rechercher par titre, ville..." 
                  [(ngModel)]="searchQuery"
                  (input)="onSearch()"
                  (keyup)="onSearch()"
                  class="search-input"
                >
              </div>
              <div class="form-group">
                <label>Type de bien</label>
                <select [(ngModel)]="selectedTypeBien" (change)="onFilterChange()">
                  <option value="">Tous les types</option>
                  <option value="VILLA">Villa</option>
                  <option value="APPARTEMENT">Appartement</option>
                  <option value="MAISON">Maison</option>
                  <option value="STUDIO">Studio</option>
                  <option value="DUPLEX">Duplex</option>
                  <option value="PENTHOUSE">Penthouse</option>
                  <option value="TERRAIN">Terrain</option>
                  <option value="LOCAL_COMMERCIAL">Local Commercial</option>
                  <option value="BUREAU">Bureau</option>
                  <option value="ENTREPOT">Entrep√¥t</option>
                </select>
              </div>
              <div class="form-group">
                <label>Transaction</label>
                <select [(ngModel)]="selectedTypeTransaction" (change)="onFilterChange()">
                  <option value="">Toutes</option>
                  <option value="VENTE">Vente</option>
                  <option value="LOCATION">Location</option>
                </select>
              </div>
              <div class="form-group">
                <label>Statut</label>
                <select [(ngModel)]="selectedStatus" (change)="onFilterChange()">
                  <option value="">Tous les statuts</option>
                  <option value="DISPONIBLE">Disponible</option>
                  <option value="VENDU">Vendu</option>
                  <option value="LOUE">Lou√©</option>
                  <option value="RESERVE">R√©serv√©</option>
                  <option value="EXPIRE">Expir√©</option>
                  <option value="SUSPENDU">Suspendu</option>
                </select>
              </div>
              <button class="btn-search" (click)="searchAnnonces()">
                <span class="material-icons">search</span>
                Rechercher
              </button>
            </div>
          </div>

<!-- Annonces List - FIXED VERSION -->
<div *ngIf="isAgencyVerified()">
  <!-- Loading state -->
  <div *ngIf="isLoadingAnnonces" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Chargement de vos annonces...</p>
  </div>

  <!-- No annonces state -->
  <div *ngIf="!isLoadingAnnonces && (!myAnnonces || !myAnnonces.content || myAnnonces.content.length === 0)" class="empty-state">
    <div class="empty-icon">
      <span class="material-icons">home_work</span>
    </div>
    <h3>Aucune annonce trouv√©e</h3>
    <p>Vous n'avez pas encore cr√©√© d'annonce. Commencez par ajouter votre premi√®re annonce !</p>
    <button class="btn btn-primary" (click)="createNewAnnonce()">
      <span class="material-icons">add</span>
      Cr√©er ma premi√®re annonce
    </button>
  </div>

  <!-- Annonces grid container - This is the key fix -->
  <div *ngIf="!isLoadingAnnonces && myAnnonces && myAnnonces.content && myAnnonces.content.length > 0" 
       class="properties-list">
    
    <!-- Individual property cards -->
    <div class="annonce-card" *ngFor="let annonce of myAnnonces.content">
      <div class="annonce-image-section">
        <div class="main-image-container">
          <div *ngIf="!annonce.premierImage" class="default-image">
            <span class="material-icons" style="font-size: 3rem; color: #94a3b8;">{{ annonce.typeBien === 'VILLA' ? 'villa' : 'home' }}</span>
          </div>
          <img *ngIf="annonce.premierImage" [src]="annonce.premierImage" [alt]="annonce.titre" class="main-image">
        </div>
        
        <div class="image-overlay">
          <div class="badges">
            <div class="badge transaction">{{ getAnnonceTypeTransactionDisplay(annonce.typeTransaction) }}</div>
            <div class="badge type">{{ getAnnonceTypeBienDisplay(annonce.typeBien) }}</div>
            <div class="badge status" [ngClass]="'status-' + annonce.status.toLowerCase()">
              {{ getAnnonceStatusDisplay(annonce.status) }}
            </div>
          </div>
        </div>
      </div>
      
      <div class="annonce-info-section">
        <div class="title-section">
          <h3 class="annonce-title">{{ annonce.titre }}</h3>
          
          <!-- Creator Information -->
          <div class="creator-info" *ngIf="annonce.createurType && annonce.createurNom">
            <div class="creator-badge" [ngClass]="'creator-' + annonce.createurType.toLowerCase()">
              <span class="material-icons">{{ annonce.createurType === 'AGENCE_IMMOBILIERE' ? 'business' : 'person' }}</span>
              <span class="creator-text">
                {{ annonce.createurType === 'AGENCE_IMMOBILIERE' ? 'Agence' : 'Client Premium' }}
              </span>
            </div>
            <div class="creator-name">{{ annonce.createurNom }} {{ annonce.createurPrenom || '' }}</div>
          </div>
        </div>
        
        <div class="location-section">
          <span class="material-icons">location_on</span>
          <ng-container *ngIf="annonce.adresse">{{ annonce.adresse }}, </ng-container>{{ annonce.ville }}<ng-container *ngIf="annonce.codePostal"> {{ annonce.codePostal }}</ng-container>
        </div>
        
        <div class="description-section" *ngIf="annonce.description">
          {{ annonce.description }}
        </div>
        
        <div class="features-section">
          <div class="features-grid">
          <div class="feature-item" *ngIf="annonce.nombreChambres">
            <span class="material-icons">bed</span>
            {{ annonce.nombreChambres }} chambres
          </div>
          <div class="feature-item" *ngIf="annonce.nombreSallesBain">
            <span class="material-icons">bathtub</span>
            {{ annonce.nombreSallesBain }} SDB
          </div>
          <div class="feature-item" *ngIf="annonce.surface">
            <span class="material-icons">square_foot</span>
            {{ annonce.surface }}m¬≤
          </div>
          <div class="feature-item" *ngIf="annonce.etage != null">
            <span class="material-icons">layers</span>
            √âtage {{ annonce.etage }}
          </div>
          </div>
        </div>
        
        <div class="footer-section">
          <div class="price-section">
            {{ formatPrice(annonce.prix) }}
            <span class="currency">TND</span>
          </div>
          
          <div class="actions-section">
            <button class="btn-action" (click)="viewAnnonce(annonce.id)" title="Voir les d√©tails">
              <span class="material-icons">visibility</span>
            </button>
            <button class="btn-action btn-edit" (click)="editAnnonce(annonce.id)" title="Modifier">
              <span class="material-icons">edit</span>
            </button>
            <button class="btn-action btn-delete" (click)="deleteAnnonce(annonce.id)" title="Supprimer">
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="myAnnonces && myAnnonces.totalPages && myAnnonces.totalPages > 1">
    <div class="pagination">
      <button class="pagination-btn" [disabled]="!myAnnonces.hasPrevious" (click)="goToPage(myAnnonces.currentPage - 1)">
        <span class="material-icons">chevron_left</span>
      </button>
      
      <button 
        class="pagination-btn" 
        [class.active]="page === myAnnonces.currentPage"
        *ngFor="let page of getPaginationPages()" 
        (click)="goToPage(page)">
        {{ page + 1 }}
      </button>
      
      <button class="pagination-btn" [disabled]="!myAnnonces.hasNext" (click)="goToPage(myAnnonces.currentPage + 1)">
        <span class="material-icons">chevron_right</span>
      </button>
      
      <div class="pagination-info">
        Page {{ myAnnonces.currentPage + 1 }} sur {{ myAnnonces.totalPages }}
        <br>
        {{ myAnnonces.totalElements }} annonces au total
      </div>
    </div>
  </div>
</div>
        </div>

        <!-- Clients CRM Section -->
        <div *ngIf="activeSection === 'clients'" class="section-content">
          <div class="clients-header">
            <h2>CRM Clients</h2>
            <button class="btn btn-primary" [disabled]="!isAgencyVerified()">
              <span class="material-icons">person_add</span>
              Nouveau client
            </button>
          </div>

          <!-- Non-verified agency message -->
          <div *ngIf="!isAgencyVerified()" class="verification-notice">
            <div class="notice-card">
              <div class="notice-icon">
                <span class="material-icons">people</span>
              </div>
              <div class="notice-content">
                <h3>Acc√®s au CRM en attente</h3>
                <p>Votre syst√®me de gestion client sera disponible une fois votre agence v√©rifi√©e.</p>
                <p>Avec le CRM, vous pourrez:</p>
                <ul>
                  <li>G√©rer vos contacts clients</li>
                  <li>Suivre les prospects</li>
                  <li>Planifier des rendez-vous</li>
                  <li>Analyser votre pipeline de ventes</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Clients Stats -->
          <div class="clients-stats">
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">people</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">156</div>
                <div class="stat-label">Total clients</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">trending_up</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">23</div>
                <div class="stat-label">Nouveaux ce mois</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">handshake</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">12</div>
                <div class="stat-label">Transactions closes</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">schedule</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">8</div>
                <div class="stat-label">RDV cette semaine</div>
              </div>
            </div>
          </div>

          <!-- Recent Clients -->
          <div class="clients-list">
            <h3>Clients r√©cents</h3>
            <div class="client-item">
              <div class="client-avatar">
                <span class="material-icons">person</span>
              </div>
              <div class="client-info">
                <h4>Marie Dupont</h4>
                <p class="client-interest">Cherche appartement 3 pi√®ces - Budget: 200k‚Ç¨</p>
                <div class="client-meta">
                  <span class="client-date">Ajout√© le 28/01/2025</span>
                  <span class="client-status active">Actif</span>
                </div>
              </div>
              <div class="client-actions">
                <button class="btn btn-sm btn-outline">
                  <span class="material-icons">event</span>
                  RDV
                </button>
                <button class="btn btn-sm btn-primary">
                  <span class="material-icons">message</span>
                  Contact
                </button>
              </div>
            </div>

            <div class="client-item">
              <div class="client-avatar">
                <span class="material-icons">person</span>
              </div>
              <div class="client-info">
                <h4>Ahmed Ben Ali</h4>
                <p class="client-interest">Vente villa Sfax - Estim√©: 380k‚Ç¨</p>
                <div class="client-meta">
                  <span class="client-date">Ajout√© le 25/01/2025</span>
                  <span class="client-status potential">Prospect</span>
                </div>
              </div>
              <div class="client-actions">
                <button class="btn btn-sm btn-outline">
                  <span class="material-icons">event</span>
                  RDV
                </button>
                <button class="btn btn-sm btn-primary">
                  <span class="material-icons">message</span>
                  Contact
                </button>
              </div>
            </div>
          </div>

          <!-- Pipeline -->
          <div class="sales-pipeline">
            <h3>Pipeline de ventes</h3>
            <div class="pipeline-stages">
              <div class="pipeline-stage">
                <h4>Prospects <span class="stage-count">12</span></h4>
                <div class="stage-value">‚Ç¨ 2.4M</div>
              </div>
              <div class="pipeline-stage">
                <h4>Qualification <span class="stage-count">8</span></h4>
                <div class="stage-value">‚Ç¨ 1.8M</div>
              </div>
              <div class="pipeline-stage">
                <h4>N√©gociation <span class="stage-count">5</span></h4>
                <div class="stage-value">‚Ç¨ 1.1M</div>
              </div>
              <div class="pipeline-stage">
                <h4>Signature <span class="stage-count">3</span></h4>
                <div class="stage-value">‚Ç¨ 650k</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Team Management Section -->
        <div *ngIf="activeSection === 'team'" class="section-content">
          <div class="team-header">
            <h2>Gestion d'√âquipe</h2>
            <button class="btn btn-primary" [disabled]="!isAgencyVerified()">
              <span class="material-icons">person_add</span>
              Inviter un membre
            </button>
          </div>

          <!-- Non-verified agency message -->
          <div *ngIf="!isAgencyVerified()" class="verification-notice">
            <div class="notice-card">
              <div class="notice-icon">
                <span class="material-icons">group</span>
              </div>
              <div class="notice-content">
                <h3>Gestion d'√©quipe indisponible</h3>
                <p>Les fonctionnalit√©s de gestion d'√©quipe seront activ√©es apr√®s v√©rification de votre agence.</p>
                <p>Une fois v√©rifi√©e, vous pourrez:</p>
                <ul>
                  <li>Inviter des collaborateurs</li>
                  <li>G√©rer les r√¥les et permissions</li>
                  <li>Suivre les performances individuelles</li>
                  <li>Organiser le travail d'√©quipe</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Team Stats -->
          <div class="team-stats">
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">group</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getAgencyInfo()?.nombreEmployes || 8 }}</div>
                <div class="stat-label">Membres d'√©quipe</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">star</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">4.8</div>
                <div class="stat-label">Note moyenne √©quipe</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">trending_up</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">89%</div>
                <div class="stat-label">Objectifs atteints</div>
              </div>
            </div>
          </div>

          <!-- Team Members -->
          <div class="team-members">
            <h3>Membres de l'√©quipe</h3>
            <div class="member-item">
              <div class="member-avatar">
                <span>JD</span>
              </div>
              <div class="member-info">
                <h4>Jean Durand</h4>
                <p class="member-role">Directeur Commercial</p>
                <div class="member-stats">
                  <span class="stat">15 ventes ce mois</span>
                  <span class="stat">‚Ç¨2.1M CA</span>
                </div>
              </div>
              <div class="member-status">
                <span class="status-badge online">En ligne</span>
              </div>
              <div class="member-actions">
                <button class="btn btn-sm btn-outline">Profil</button>
                <button class="btn btn-sm btn-primary">Message</button>
              </div>
            </div>

            <div class="member-item">
              <div class="member-avatar">
                <span>SM</span>
              </div>
              <div class="member-info">
                <h4>Sophie Martin</h4>
                <p class="member-role">N√©gociatrice</p>
                <div class="member-stats">
                  <span class="stat">12 ventes ce mois</span>
                  <span class="stat">‚Ç¨1.8M CA</span>
                </div>
              </div>
              <div class="member-status">
                <span class="status-badge away">Absent</span>
              </div>
              <div class="member-actions">
                <button class="btn btn-sm btn-outline">Profil</button>
                <button class="btn btn-sm btn-primary">Message</button>
              </div>
            </div>
          </div>

          <!-- Performance Chart -->
          <div class="team-performance">
            <h3>Performance d'√©quipe</h3>
            <div class="performance-chart">
              <div class="chart-placeholder">
                <span class="material-icons">bar_chart</span>
                <p>Graphique de performance d'√©quipe disponible avec Chart.js</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Section -->
        <div *ngIf="activeSection === 'analytics'" class="section-content">
          <div class="agency-analytics-header">
            <h2>Analytics Agence</h2>
            <div class="analytics-filters">
              <select class="form-select">
                <option>Ce mois</option>
                <option>3 derniers mois</option>
                <option>Cette ann√©e</option>
              </select>
            </div>
          </div>

          <!-- Non-verified agency message -->
          <div *ngIf="!isAgencyVerified()" class="verification-notice">
            <div class="notice-card">
              <div class="notice-icon">
                <span class="material-icons">analytics</span>
              </div>
              <div class="notice-content">
                <h3>Analytics premium en attente</h3>
                <p>L'acc√®s aux statistiques avanc√©es sera disponible apr√®s v√©rification de votre agence.</p>
                <p>Vous aurez acc√®s √† :</p>
                <ul>
                  <li>Tableau de bord des performances</li>
                  <li>Analyses de march√©</li>
                  <li>Rapports de conversion</li>
                  <li>Insights sur la concurrence</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoadingAnalytics && isAgencyVerified()" class="loading-container">
            <div class="spinner"></div>
            <p>Chargement des donn√©es analytiques...</p>
          </div>

          <!-- Key Performance Indicators -->
          <div *ngIf="!isLoadingAnalytics && analyticsData && isAgencyVerified()" class="kpi-grid">
            <div *ngFor="let kpi of analyticsData.kpis" 
                 class="kpi-card animated-kpi-card"
                 (click)="showMetricDetails(kpi)">
              <div class="kpi-icon">
                <span class="material-icons" [style.color]="kpi.color">{{ kpi.icon }}</span>
              </div>
              <div class="kpi-content">
                <div class="kpi-number">{{ kpi.value }}</div>
                <div class="kpi-label">{{ kpi.label }}</div>
                <div class="kpi-trend" [ngClass]="kpi.trend">
                  <span class="material-icons">
                    {{ kpi.trend === 'positive' ? 'trending_up' : 
                       kpi.trend === 'negative' ? 'trending_down' : 'trending_flat' }}
                  </span>
                  {{ kpi.percentage ? '+' + kpi.percentage + '%' : 'Stable' }}
                </div>
              </div>
            </div>
          </div>

          <!-- Performance Charts -->
          <div *ngIf="!isLoadingAnalytics && analyticsData && isAgencyVerified()" class="analytics-charts">
            <div *ngFor="let chart of analyticsData.performanceCharts" class="chart-grid-item">
              <app-animated-chart 
                [chartData]="chart"
                [showLegend]="true"
                [animated]="true"
                [responsive]="true">
              </app-animated-chart>
            </div>
          </div>

          <!-- Market Analysis -->
          <div class="market-analysis">
            <h3>Analyse de march√©</h3>
            <div class="market-insights">
              <div class="insight-item">
                <span class="insight-label">Prix m¬≤ moyen secteur</span>
                <span class="insight-value">2,450‚Ç¨</span>
                <span class="insight-change positive">+3.2%</span>
              </div>
              <div class="insight-item">
                <span class="insight-label">Temps de vente moyen</span>
                <span class="insight-value">67 jours</span>
                <span class="insight-change positive">-8 jours</span>
              </div>
              <div class="insight-item">
                <span class="insight-label">Concurrence directe</span>
                <span class="insight-value">12 agences</span>
                <span class="insight-change neutral">Stable</span>
              </div>
            </div>
          </div>
        </div>
        <!-- Comments Management Section for Agencies -->
        <div *ngIf="activeSection === 'comments'" class="section-content">
          <div class="comments-management-header">
            <h2>Commentaires sur vos Annonces</h2>
            <p>G√©rez les commentaires et √©valuations re√ßus sur vos propri√©t√©s</p>
            <button class="btn btn-primary" (click)="loadCommentsForMyAnnonces()">
              <span class="material-icons">refresh</span>
              Actualiser
            </button>
          </div>

          <!-- Loading State -->
          <div *ngIf="isLoadingMyComments" class="loading-container">
            <div class="spinner"></div>
            <p>Chargement des commentaires...</p>
          </div>

          <!-- Comments List -->
          <div *ngIf="!isLoadingMyComments && myAnnonceComments" class="comments-management">
            <div class="comments-stats">
              <div class="stat-card">
                <div class="stat-icon">
                  <span class="material-icons">comment</span>
                </div>
                <div class="stat-content">
                  <div class="stat-number">{{ myAnnonceComments?.totalElements || 0 }}</div>
                  <div class="stat-label">Total commentaires</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <span class="material-icons">star</span>
                </div>
                <div class="stat-content">
                  <div class="stat-number">4.2</div>
                  <div class="stat-label">Note moyenne</div>
                </div>
              </div>
            </div>

            <div class="comments-list">
              <div *ngFor="let comment of myAnnonceComments?.content" class="comment-management-item">
                <div class="comment-header">
                  <div class="comment-author">
                    <div class="author-avatar">{{ comment.userName.charAt(0) }}</div>
                    <div class="author-info">
                      <div class="author-name">{{ comment.userName }}</div>
                      <div class="comment-date">{{ comment.createdAt | date:'short' }}</div>
                    </div>
                  </div>
                  <div class="comment-rating">
                    <span *ngFor="let star of [1,2,3,4,5]" 
                          class="material-icons rating-star"
                          [class.filled]="star <= comment.rating">
                      star
                    </span>
                  </div>
                </div>
                <div class="comment-content">
                  <div class="comment-text" *ngIf="comment.content && comment.content.trim()">{{ comment.content }}</div>
                  <div class="comment-text" *ngIf="!comment.content || !comment.content.trim()" style="font-style: italic; color: #94a3b8;">
                    Commentaire sans texte (√©valuation uniquement)
                  </div>
                  <div class="comment-annonce">
                    Annonce: <strong>{{ comment.annonceTitle || 'Annonce #' + comment.annonceId }}</strong>
                  </div>
                </div>
                <div class="comment-actions">
                  <button class="btn btn-sm btn-outline" (click)="viewAnnonce(comment.annonceId)">
                    <span class="material-icons">visibility</span>
                    Voir l'annonce
                  </button>
                  <button class="btn btn-sm btn-primary" 
                          (click)="startReply(comment.id)"
                          [disabled]="isSubmittingReply">
                    <span class="material-icons">reply</span>
                    R√©pondre
                  </button>
                </div>

                <!-- Reply Form -->
                <div *ngIf="replyingToComment === comment.id" class="reply-form">
                  <div class="reply-header">
                    <span class="material-icons">reply</span>
                    <span>R√©pondre √† {{ comment.userName }}</span>
                  </div>
                  <div class="reply-input-container">
                    <textarea 
                      [(ngModel)]="replyContent"
                      placeholder="√âcrivez votre r√©ponse..."
                      class="reply-textarea"
                      rows="3"
                      [disabled]="isSubmittingReply">
                    </textarea>
                  </div>
                  <div class="reply-actions">
                    <button class="btn btn-sm btn-secondary" 
                            (click)="cancelReply()"
                            [disabled]="isSubmittingReply">
                      <span class="material-icons">close</span>
                      Annuler
                    </button>
                    <button class="btn btn-sm btn-primary" 
                            (click)="submitReply(comment.id)"
                            [disabled]="!replyContent?.trim() || isSubmittingReply">
                      <span class="material-icons" *ngIf="!isSubmittingReply">send</span>
                      <span class="material-icons rotating" *ngIf="isSubmittingReply">refresh</span>
                      {{ isSubmittingReply ? 'Envoi...' : 'Envoyer' }}
                    </button>
                  </div>
                </div>

                <!-- Display Replies -->
                <div class="replies-section" *ngIf="comment.replies && comment.replies.length > 0">
                  <div class="replies-header">
                    <span class="material-icons">subdirectory_arrow_right</span>
                    <span>{{ comment.replies.length }} r√©ponse(s)</span>
                  </div>
                  <div *ngFor="let reply of comment.replies" class="reply-item">
                    <div class="reply-author">
                      <div class="author-avatar agency">
                        <span class="material-icons">business</span>
                      </div>
                      <div class="author-info">
                        <div class="author-name">{{ reply.userName }} <span class="agency-badge">Agence</span></div>
                        <div class="reply-date">{{ reply.createdAt | date:'short' }}</div>
                      </div>
                    </div>
                    <div class="reply-content">{{ reply.content }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- No Comments State -->
            <div *ngIf="myAnnonceComments?.content?.length === 0" class="no-comments">
              <div class="no-comments-content">
                <span class="material-icons">comment</span>
                <h3>Aucun commentaire pour le moment</h3>
                <p>Vos annonces n'ont pas encore re√ßu de commentaires.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Verification Section -->
        <div *ngIf="activeSection === 'verification'" class="section-content">
          <div class="verification-status">
            <div class="verification-card" [class]="isAgencyVerified() ? 'verified' : 'pending'">
              <div class="verification-icon">
                <span class="material-icons">
                  {{ isAgencyVerified() ? 'verified' : 'schedule' }}
                </span>
              </div>
              <div class="verification-content">
                <h3>{{ isAgencyVerified() ? 'Agence V√©rifi√©e' : 'V√©rification en Cours' }}</h3>
                <p *ngIf="!isAgencyVerified()">
                  Votre demande de v√©rification est en cours de traitement. 
                  Vous recevrez une notification par email une fois le processus termin√©.
                </p>
                <p *ngIf="isAgencyVerified()">
                  F√©licitations ! Votre agence a √©t√© v√©rifi√©e avec succ√®s. 
                  Vous avez maintenant acc√®s √† toutes les fonctionnalit√©s professionnelles.
                </p>
                
                <!-- Required Documents -->
                <div class="verification-documents" *ngIf="!isAgencyVerified()">
                  <h4>Documents requis</h4>
                  <div class="document-list">
                    <div class="document-item completed">
                      <span class="material-icons">check_circle</span>
                      <span>Carte professionnelle</span>
                    </div>
                    <div class="document-item completed">
                      <span class="material-icons">check_circle</span>
                      <span>Justificatif d'assurance</span>
                    </div>
                    <div class="document-item pending">
                      <span class="material-icons">schedule</span>
                      <span>Attestation FNAIM (en cours)</span>
                    </div>
                  </div>
                </div>

                <!-- Benefits -->
                <div class="verification-benefits" *ngIf="isAgencyVerified()">
                  <h4>Avantages d√©bloqu√©s</h4>
                  <div class="benefit-list">
                    <div class="benefit-item">
                      <span class="material-icons">verified</span>
                      <span>Badge de confiance affich√©</span>
                    </div>
                    <div class="benefit-item">
                      <span class="material-icons">priority_high</span>
                      <span>Annonces prioritaires</span>
                    </div>
                    <div class="benefit-item">
                      <span class="material-icons">analytics</span>
                      <span>Statistiques avanc√©es</span>
                    </div>
                    <div class="benefit-item">
                      <span class="material-icons">support</span>
                      <span>Support d√©di√©</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Section -->
        <div *ngIf="activeSection === 'profile'" class="section-content profile-section">
          <!-- Profile Header -->
          <div class="profile-section-header" *ngIf="!isEditingProfile">
            <div class="section-title">
              <h2>Profil Agence</h2>
              <p>G√©rez les informations de votre agence</p>
            </div>
            <button class="btn btn-primary" (click)="startEditProfile()">
              <span class="material-icons">edit</span>
              Modifier les informations
            </button>
          </div>

          <!-- Profile View Mode -->
          <div *ngIf="!isEditingProfile">
            <app-profile-view [user]="currentUser"></app-profile-view>
          </div>

          <!-- Profile Edit Mode -->
          <div *ngIf="isEditingProfile">
            <app-profile-sections 
              [user]="currentUser"
              (saved)="onProfileSaved($event)"
              (cancelled)="cancelEditProfile()"
              (passwordChanged)="onPasswordChanged()">
            </app-profile-sections>
          </div>
        </div>
      </div>

      <!-- ADMINISTRATEUR Dashboard -->
      <div *ngIf="isAdmin()" class="dashboard-content">
        <!-- Overview Section -->
        <div *ngIf="activeSection === 'overview'" class="section-content">
          <div class="admin-welcome">
            <h2>Tableau de bord administrateur</h2>
            <p>G√©rez la plateforme ImmoConnect</p>
          </div>

          <div class="stats-grid large">
            <div class="stat-card">
              <div class="stat-icon primary">
                <span class="material-icons">people</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getTotalUsers() }}</div>
                <div class="stat-label">Total Utilisateurs</div>
                <div class="stat-trend positive">+12% ce mois</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon success">
                <span class="material-icons">verified_user</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getActiveUsers() }}</div>
                <div class="stat-label">Utilisateurs Actifs</div>
                <div class="stat-trend positive">+8% ce mois</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon warning">
                <span class="material-icons">business</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ userStats?.pendingVerifications || 0 }}</div>
                <div class="stat-label">V√©rifications en attente</div>
                <div class="stat-trend neutral">Action requise</div>
              </div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon info">
                <span class="material-icons">visibility</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">{{ getTotalVisits() }}</div>
                <div class="stat-label">Visites Total</div>
                <div class="stat-trend positive">+15% ce mois</div>
              </div>
            </div>
          </div>

          <div class="admin-quick-actions">
            <h3>Actions rapides</h3>
            <div class="action-cards">
              <div class="action-card" (click)="setActiveSection('users')">
                <span class="material-icons">people</span>
                <span>G√©rer les utilisateurs</span>
              </div>
              <div class="action-card" (click)="setActiveSection('agencies')">
                <span class="material-icons">business</span>
                <span>V√©rifier les agences</span>
              </div>
              <div class="action-card" (click)="setActiveSection('statistics')">
                <span class="material-icons">analytics</span>
                <span>Voir les statistiques</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Users Management Section -->
        <div *ngIf="activeSection === 'users'" class="section-content">
          <div class="users-header">
            <h2>Gestion des Utilisateurs</h2>
            <div class="users-actions">
              <input type="text" class="search-input" placeholder="Rechercher un utilisateur...">
              <select class="filter-select">
                <option value="">Tous les types</option>
                <option value="UTILISATEUR">Utilisateur Standard</option>
                <option value="CLIENT_ABONNE">Client Abonn√©</option>
                <option value="AGENCE_IMMOBILIERE">Agence Immobili√®re</option>
                <option value="ADMINISTRATEUR">Administrateur</option>
                <option value="ADMINISTRATEUR">Administrateur</option>
              </select>
              <button class="btn btn-primary">
                <span class="material-icons">person_add</span>
                Nouvel utilisateur
                </button>
            </div>
          </div>

          <!-- Users Stats -->
          <div class="users-stats">
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">people</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">1,247</div>
                <div class="stat-label">Total utilisateurs</div>
                <div class="stat-change positive">+18 cette semaine</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">person</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">892</div>
                <div class="stat-label">Utilisateurs Standard</div>
                <div class="stat-change positive">+12</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">star</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">284</div>
                <div class="stat-label">Clients Abonn√©s</div>
                <div class="stat-change positive">+5</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">business</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">67</div>
                <div class="stat-label">Agences</div>
                <div class="stat-change positive">+1</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">admin_panel_settings</span>
              </div>
              <div class="stat-content">
                <div class="stat-number">4</div>
                <div class="stat-label">Administrateurs</div>
                <div class="stat-change neutral">Stable</div>
              </div>
            </div>
          </div>

          <!-- Users Table -->
          <div class="users-table">
            <div class="table-header">
              <h3>Liste des utilisateurs</h3>
              <div class="table-actions">
                <button class="btn btn-sm btn-outline">
                  <span class="material-icons">download</span>
                  Exporter
                </button>
                <button class="btn btn-sm btn-secondary">
                  <span class="material-icons">filter_list</span>
                  Filtres avanc√©s
                </button>
              </div>
            </div>

            <div class="table-content">
              <div class="user-row header">
                <div class="user-col">Utilisateur</div>
                <div class="user-col">Type</div>
                <div class="user-col">Status</div>
                <div class="user-col">Derni√®re connexion</div>
                <div class="user-col">Actions</div>
              </div>

              <div class="user-row">
                <div class="user-col user-info">
                  <div class="user-avatar">MD</div>
                  <div class="user-details">
                    <div class="user-name">Marie Dupont</div>
                    <div class="user-email">marie.dupont@email.com</div>
                  </div>
                </div>
                <div class="user-col">
                  <span class="type-badge client-abonne">Client Abonn√©</span>
                </div>
                <div class="user-col">
                  <span class="status-badge active">
                    <span class="material-icons">verified</span>
                    Actif
                  </span>
                </div>
                <div class="user-col">Il y a 2 heures</div>
                <div class="user-col actions">
                  <button class="btn btn-sm btn-outline" title="Voir le profil">
                    <span class="material-icons">visibility</span>
                  </button>
                  <button class="btn btn-sm btn-secondary" title="Modifier">
                    <span class="material-icons">edit</span>
                  </button>
                  <button class="btn btn-sm btn-danger" title="Suspendre">
                    <span class="material-icons">block</span>
                  </button>
                </div>
              </div>

              <div class="user-row">
                <div class="user-col user-info">
                  <div class="user-avatar">AI</div>
                  <div class="user-details">
                    <div class="user-name">Agence ImmoPlus</div>
                    <div class="user-email">contact@immoplus.tn</div>
                  </div>
                </div>
                <div class="user-col">
                  <span class="type-badge agency">Agence</span>
                </div>
                <div class="user-col">
                  <span class="status-badge pending">
                    <span class="material-icons">schedule</span>
                    En attente
                  </span>
                </div>
                <div class="user-col">Il y a 1 jour</div>
                <div class="user-col actions">
                  <button class="btn btn-sm btn-outline" title="Voir le profil">
                    <span class="material-icons">visibility</span>
                  </button>
                  <button class="btn btn-sm btn-primary" title="V√©rifier">
                    <span class="material-icons">verified</span>
                  </button>
                  <button class="btn btn-sm btn-danger" title="Rejeter">
                    <span class="material-icons">close</span>
                  </button>
                </div>
              </div>

              <div class="user-row">
                <div class="user-col user-info">
                  <div class="user-avatar">JM</div>
                  <div class="user-details">
                    <div class="user-name">Jean Martin</div>
                    <div class="user-email">jean.martin@email.com</div>
                  </div>
                </div>
                <div class="user-col">
                  <span class="type-badge utilisateur">Standard</span>
                </div>
                <div class="user-col">
                  <span class="status-badge active">
                    <span class="material-icons">verified</span>
                    Actif
                  </span>
                </div>
                <div class="user-col">Il y a 3 jours</div>
                <div class="user-col actions">
                  <button class="btn btn-sm btn-outline" title="Voir le profil">
                    <span class="material-icons">visibility</span>
                  </button>
                  <button class="btn btn-sm btn-secondary" title="Modifier">
                    <span class="material-icons">edit</span>
                  </button>
                  <button class="btn btn-sm btn-warning" title="Promouvoir">
                    <span class="material-icons">upgrade</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Pagination -->
            <div class="table-pagination">
              <div class="pagination-info">
                Affichage 1-25 sur 1,247 utilisateurs
              </div>
              <div class="pagination-controls">
                <button class="btn btn-sm btn-outline" disabled>
                  <span class="material-icons">chevron_left</span>
                </button>
                <span class="page-numbers">
                  <button class="btn btn-sm active">1</button>
                  <button class="btn btn-sm">2</button>
                  <button class="btn btn-sm">3</button>
                  <span>...</span>
                  <button class="btn btn-sm">50</button>
                </span>
                <button class="btn btn-sm btn-outline">
                  <span class="material-icons">chevron_right</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Agencies Management Section -->
        <div *ngIf="activeSection === 'agencies'" class="section-content">
          <div class="agencies-header">
            <h2>V√©rification des Agences</h2>
            <div class="agencies-stats-summary">
              <span class="stat-item">
                <strong>{{ getPendingAgenciesCount() }}</strong> en attente
              </span>
              <span class="stat-item">
                <strong>{{ getVerifiedAgenciesCount() }}</strong> v√©rifi√©es
              </span>
              <span class="stat-item">
                <strong>0</strong> rejet√©es
              </span>
            </div>
          </div>

          <!-- Verification Queue -->
          <div class="verification-queue">
            <h3>File d'attente de v√©rification</h3>
            <div *ngIf="isLoadingAgencies" class="loading-message">
              Chargement des agences...
            </div>
            <div *ngIf="!isLoadingAgencies && pendingAgencies.length === 0" class="empty-message">
              Aucune agence en attente de v√©rification
            </div>
            <div *ngFor="let agency of pendingAgencies" class="queue-item">
              <div class="agency-info">
                <div class="agency-avatar">{{ getAgencyInitials(agency) }}</div>
                <div class="agency-details">
                  <h4>{{ agency.nomAgence || (agency.prenom + ' ' + agency.nom) }}</h4>
                  <p class="agency-email">{{ agency.email }}</p>
                  <p class="agency-license" *ngIf="agency.numeroLicence">Licence: #{{ agency.numeroLicence }}</p>
                  <p class="agency-phone" *ngIf="agency.telephone">T√©l: {{ agency.telephone }}</p>
                  <p class="agency-address" *ngIf="agency.adresse">{{ agency.adresse }}</p>
                </div>
              </div>
              <div class="submission-date">
                <span class="date-label">Inscrit le</span>
                <span class="date-value">{{ agency.createdAt | date:'dd/MM/yyyy' }}</span>
                <span class="urgency-badge normal">En attente</span>
              </div>
              <div class="documents-status">
                <div class="doc-item" [class.complete]="agency.emailVerified" [class.pending]="!agency.emailVerified">
                  <span class="material-icons">{{ agency.emailVerified ? 'check_circle' : 'schedule' }}</span>
                  <span>Email {{ agency.emailVerified ? 'v√©rifi√©' : 'non v√©rifi√©' }}</span>
                </div>
                <div class="doc-item" [class.complete]="agency.numeroLicence" [class.pending]="!agency.numeroLicence">
                  <span class="material-icons">{{ agency.numeroLicence ? 'check_circle' : 'schedule' }}</span>
                  <span>Num√©ro de licence {{ agency.numeroLicence ? 'fourni' : 'manquant' }}</span>
                </div>
                <div class="doc-item" [class.complete]="agency.siteWeb" [class.pending]="!agency.siteWeb">
                  <span class="material-icons">{{ agency.siteWeb ? 'check_circle' : 'help_outline' }}</span>
                  <span>Site web {{ agency.siteWeb ? 'fourni' : 'optionnel' }}</span>
                </div>
              </div>
              <div class="verification-actions">
                <button class="btn btn-sm btn-success" (click)="verifyAgency(agency.id!)">
                  <span class="material-icons">verified</span>
                  Approuver
                </button>
                <button class="btn btn-sm btn-danger" disabled>
                  <span class="material-icons">close</span>
                  Rejeter
                </button>
              </div>
            </div>
          </div>

          <!-- Verified Agencies -->
          <div class="verified-agencies">
            <h3>Agences v√©rifi√©es r√©cemment</h3>
            <div class="verified-list">
              <div *ngIf="verifiedAgencies.length === 0" class="empty-message">
                Aucune agence v√©rifi√©e pour le moment
              </div>
              <div *ngFor="let agency of verifiedAgencies.slice(0, 5)" class="verified-item">
                <div class="agency-info">
                  <div class="agency-avatar verified">{{ getAgencyInitials(agency) }}</div>
                  <div class="agency-details">
                    <h4>{{ agency.nomAgence || (agency.prenom + ' ' + agency.nom) }}</h4>
                    <p class="verification-date">V√©rifi√©e (date non disponible)</p>
                    <p *ngIf="agency.siteWeb" class="agency-website">{{ agency.siteWeb }}</p>
                  </div>
                </div>
                <div class="agency-performance">
                  <span class="performance-metric">{{ agency.nombreEmployes || 'N/A' }} employ√©s</span>
                  <span class="performance-metric" *ngIf="agency.zonesCouverture">{{ agency.zonesCouverture }}</span>
                  <span class="performance-rating">
                    <span class="material-icons">verified</span>
                    V√©rifi√©e
                  </span>
                </div>
                <div class="agency-actions">
                  <button class="btn btn-sm btn-outline">
                    <span class="material-icons">visibility</span>
                    Voir d√©tails
                  </button>
                  <button class="btn btn-sm btn-warning" disabled>
                    <span class="material-icons">pause</span>
                    Suspendre
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Verification Guidelines -->
          <div class="verification-guidelines">
            <h3>Crit√®res de v√©rification</h3>
            <div class="guidelines-grid">
              <div class="guideline-item">
                <span class="material-icons">badge</span>
                <div class="guideline-content">
                  <h4>Carte professionnelle</h4>
                  <p>Carte T ou carte de transaction immobili√®re valide</p>
                </div>
              </div>
              <div class="guideline-item">
                <span class="material-icons">security</span>
                <div class="guideline-content">
                  <h4>Assurance RC</h4>
                  <p>Responsabilit√© civile professionnelle en cours</p>
                </div>
              </div>
              <div class="guideline-item">
                <span class="material-icons">account_balance</span>
                <div class="guideline-content">
                  <h4>Garantie financi√®re</h4>
                  <p>Garantie bancaire ou caution professionnelle</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Statistics Section -->
        <div *ngIf="activeSection === 'statistics'" class="section-content">
          <div class="admin-statistics">
            <h2>Statistiques de la Plateforme</h2>
            
            <!-- Global KPIs -->
            <div class="global-kpis">
              <div class="kpi-card primary">
                <div class="kpi-header">
                  <span class="material-icons">people</span>
                  <h3>Utilisateurs</h3>
                </div>
                <div class="kpi-metrics">
                  <div class="metric">
                    <span class="metric-value">{{ getTotalUsers() }}</span>
                    <span class="metric-label">Total</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">{{ getActiveUsers() }}</span>
                    <span class="metric-label">Actifs (30j)</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">+18</span>
                    <span class="metric-label">Cette semaine</span>
                  </div>
                </div>
              </div>

              <div class="kpi-card success">
                <div class="kpi-header">
                  <span class="material-icons">euro</span>
                  <h3>Revenue</h3>
                </div>
                <div class="kpi-metrics">
                  <div class="metric">
                    <span class="metric-value">‚Ç¨47,650</span>
                    <span class="metric-label">Ce mois</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">‚Ç¨142,300</span>
                    <span class="metric-label">Trimestre</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">+23%</span>
                    <span class="metric-label">Croissance</span>
                  </div>
                </div>
              </div>

              <div class="kpi-card info">
                <div class="kpi-header">
                  <span class="material-icons">visibility</span>
                  <h3>Trafic</h3>
                </div>
                <div class="kpi-metrics">
                  <div class="metric">
                    <span class="metric-value">{{ getTotalVisits() }}</span>
                    <span class="metric-label">Visites totales</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">{{ getUniqueVisitors() }}</span>
                    <span class="metric-label">Visiteurs uniques</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">2.4</span>
                    <span class="metric-label">Pages/session</span>
                  </div>
                </div>
              </div>

            <div class="kpi-card warning">
                <div class="kpi-header">
                  <span class="material-icons">business</span>
                  <h3>Agences</h3>
                </div>
                <div class="kpi-metrics">
                  <div class="metric">
                    <span class="metric-value">67</span>
                    <span class="metric-label">V√©rifi√©es</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">12</span>
                    <span class="metric-label">En attente</span>
                  </div>
                  <div class="metric">
                    <span class="metric-value">94%</span>
                    <span class="metric-label">Taux approbation</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
              <div class="chart-container large">
                <h3>Croissance des utilisateurs (6 derniers mois)</h3>
                <div class="chart-placeholder">
                  <span class="material-icons">trending_up</span>
                  <p>Graphique de croissance mensuelle - Int√©gration Chart.js</p>
                  <div class="sample-data">
                    <span class="data-point">Ao√ªt: 1,180</span>
                    <span class="data-point">Sept: 1,205</span>
                    <span class="data-point">Oct: 1,198</span>
                    <span class="data-point">Nov: 1,235</span>
                    <span class="data-point">D√©c: 1,241</span>
                    <span class="data-point">Jan: 1,247</span>
                  </div>
                </div>
              </div>

              <div class="chart-container">
                <h3>R√©partition par type d'utilisateur</h3>
                <div class="chart-placeholder">
                  <span class="material-icons">donut_large</span>
                  <p>Graphique en secteurs</p>
                  <div class="sample-breakdown">
                    <div class="breakdown-item">
                      <span class="color-indicator standard"></span>
                      <span>Standard: 892 (71.5%)</span>
                    </div>
                    <div class="breakdown-item">
                      <span class="color-indicator premium"></span>
                      <span>Premium: 284 (22.8%)</span>
                    </div>
                    <div class="breakdown-item">
                      <span class="color-indicator agency"></span>
                      <span>Agences: 67 (5.4%)</span>
                    </div>
                    <div class="breakdown-item">
                      <span class="color-indicator admin"></span>
                      <span>Admin: 4 (0.3%)</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="chart-container">
                <h3>Revenus mensuels</h3>
                <div class="chart-placeholder">
                  <span class="material-icons">bar_chart</span>
                  <p>Graphique des revenus par abonnement</p>
                  <div class="revenue-summary">
                    <div class="revenue-item">
                      <span class="revenue-type">Premium (29‚Ç¨)</span>
                      <span class="revenue-amount">‚Ç¨8,236</span>
                    </div>
                    <div class="revenue-item">
                      <span class="revenue-type">VIP (99‚Ç¨)</span>
                      <span class="revenue-amount">‚Ç¨39,414</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Detailed Reports -->
            <div class="reports-section">
              <h3>Rapports d√©taill√©s</h3>
              <div class="reports-grid">
                <div class="report-card">
                  <div class="report-header">
                    <span class="material-icons">assessment</span>
                    <h4>Rapport mensuel</h4>
                  </div>
                  <p>Analyse compl√®te des performances de la plateforme</p>
                  <button class="btn btn-primary">
                    <span class="material-icons">download</span>
                    T√©l√©charger PDF
                  </button>
                </div>
                <div class="report-card">
                  <div class="report-header">
                    <span class="material-icons">table_chart</span>
                    <h4>Export utilisateurs</h4>
                  </div>
                  <p>Liste compl√®te des utilisateurs avec d√©tails</p>
                  <button class="btn btn-outline">
                    <span class="material-icons">download</span>
                    Export Excel
                  </button>
                </div>
                <div class="report-card">
                  <div class="report-header">
                    <span class="material-icons">insights</span>
                    <h4>Analytics avanc√©s</h4>
                  </div>
                  <p>M√©triques d√©taill√©es et insights business</p>
                  <button class="btn btn-secondary">
                    <span class="material-icons">open_in_new</span>
                    Voir dashboard
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Visits Section -->
        <div *ngIf="activeSection === 'visits'" class="section-content">
          <div class="visits-analytics">
            <h2>Trafic & Visites</h2>

            <!-- Traffic Overview -->
            <div class="traffic-overview">
              <div class="traffic-stat">
                <div class="stat-icon">
                  <span class="material-icons">visibility</span>
                </div>
                <div class="stat-content">
                  <div class="stat-number">{{ getTotalVisits() }}</div>
                  <div class="stat-label">Visites totales</div>
                  <div class="stat-period">Ce mois</div>
                </div>
              </div>
              <div class="traffic-stat">
                <div class="stat-icon">
                  <span class="material-icons">people</span>
                </div>
                <div class="stat-content">
                  <div class="stat-number">{{ getUniqueVisitors() }}</div>
                  <div class="stat-label">Visiteurs uniques</div>
                  <div class="stat-period">Ce mois</div>
                </div>
              </div>
              <div class="traffic-stat">
                <div class="stat-icon">
                  <span class="material-icons">schedule</span>
                </div>
                <div class="stat-content">
                  <div class="stat-number">3m 42s</div>
                  <div class="stat-label">Dur√©e moyenne session</div>
                  <div class="stat-period">Moyenne</div>
                </div>
              </div>
              <div class="traffic-stat">
                <div class="stat-icon">
                  <span class="material-icons">trending_up</span>
                </div>
                <div class="stat-content">
                  <div class="stat-number">68%</div>
                  <div class="stat-label">Taux de rebond</div>
                  <div class="stat-period">Am√©lioration +5%</div>
                </div>
              </div>
            </div>

            <!-- Traffic Chart -->
            <div class="traffic-chart">
              <h3>√âvolution du trafic (7 derniers jours)</h3>
              <div class="chart-placeholder">
                <span class="material-icons">timeline</span>
                <p>Graphique temporel des visites - Chart.js</p>
                <div class="daily-stats">
                  <span class="day-stat">Lun: 1,234</span>
                  <span class="day-stat">Mar: 1,456</span>
                  <span class="day-stat">Mer: 1,389</span>
                  <span class="day-stat">Jeu: 1,567</span>
                  <span class="day-stat">Ven: 1,789</span>
                  <span class="day-stat">Sam: 1,234</span>
                  <span class="day-stat">Dim: 1,123</span>
                </div>
              </div>
            </div>

            <!-- Geographic Distribution -->
            <div class="geographic-stats">
              <h3>R√©partition g√©ographique</h3>
              <div class="geo-list">
                <div class="geo-item">
                  <div class="country-info">
                    <span class="country-flag">üáπüá≥</span>
                    <span class="country-name">Tunisie</span>
                  </div>
                  <div class="country-stats">
                    <span class="visitor-count">8,456 visiteurs</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 85%"></div>
                    </div>
                    <span class="percentage">85%</span>
                  </div>
                </div>
                <div class="geo-item">
                  <div class="country-info">
                    <span class="country-flag">üá´üá∑</span>
                    <span class="country-name">France</span>
                  </div>
                  <div class="country-stats">
                    <span class="visitor-count">1,234 visiteurs</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 12%"></div>
                    </div>
                    <span class="percentage">12%</span>
                  </div>
                </div>
                <div class="geo-item">
                  <div class="country-info">
                    <span class="country-flag">üá©üá™</span>
                    <span class="country-name">Allemagne</span>
                  </div>
                  <div class="country-stats">
                    <span class="visitor-count">298 visiteurs</span>
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: 3%"></div>
                    </div>
                    <span class="percentage">3%</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Top Pages -->
            <div class="top-pages">
              <h3>Pages les plus visit√©es</h3>
            <div class="pages-list">
                <div class="page-item">
                  <div class="page-info">
                    <span class="page-path">/dashboard</span>
                    <span class="page-title">Tableau de bord</span>
                  </div>
                  <div class="page-stats">
                    <span class="page-views">3,456 vues</span>
                    <span class="page-percentage">34%</span>
                  </div>
                </div>
                <div class="page-item">
                  <div class="page-info">
                    <span class="page-path">/login</span>
                    <span class="page-title">Connexion</span>
                  </div>
                  <div class="page-stats">
                    <span class="page-views">2,789 vues</span>
                    <span class="page-percentage">28%</span>
                  </div>
                </div>
                <div class="page-item">
                  <div class="page-info">
                    <span class="page-path">/register</span>
                    <span class="page-title">Inscription</span>
                  </div>
                  <div class="page-stats">
                    <span class="page-views">1,567 vues</span>
                    <span class="page-percentage">16%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- System Administration Section -->
        <div *ngIf="activeSection === 'system'" class="section-content">
          <div class="system-admin">
            <h2>Administration Syst√®me</h2>

            <!-- System Health -->
            <div class="system-health">
              <h3>√âtat du syst√®me</h3>
              <div class="health-grid">
                <div class="health-item healthy">
                  <div class="health-icon">
                    <span class="material-icons">cloud</span>
                  </div>
                  <div class="health-info">
                    <div class="health-label">Serveur Web</div>
                    <div class="health-status">Op√©rationnel</div>
                    <div class="health-uptime">99.9% uptime</div>
                  </div>
                </div>
                <div class="health-item healthy">
                  <div class="health-icon">
                    <span class="material-icons">storage</span>
                  </div>
                  <div class="health-info">
                    <div class="health-label">Base de donn√©es</div>
                    <div class="health-status">Op√©rationnel</div>
                    <div class="health-uptime">Connexions: 45/100</div>
                  </div>
                </div>
                <div class="health-item warning">
                  <div class="health-icon">
                    <span class="material-icons">email</span>
                  </div>
                  <div class="health-info">
                    <div class="health-label">Service Email</div>
                    <div class="health-status">Surveillance</div>
                    <div class="health-uptime">Queue: 23 emails</div>
                  </div>
                </div>
                <div class="health-item healthy">
                  <div class="health-icon">
                    <span class="material-icons">backup</span>
                  </div>
                  <div class="health-info">
                    <div class="health-label">Sauvegardes</div>
                    <div class="health-status">√Ä jour</div>
                    <div class="health-uptime">Derni√®re: il y a 2h</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- System Configuration -->
            <div class="system-config">
              <h3>Configuration</h3>
              <div class="config-sections">
                <div class="config-section">
                  <h4>Param√®tres g√©n√©raux</h4>
                  <div class="config-list">
                    <div class="config-item">
                      <span class="config-label">Mode maintenance</span>
                      <div class="config-control">
                        <label class="switch">
                          <input type="checkbox">
                          <span class="slider"></span>
                        </label>
                      </div>
                    </div>
                    <div class="config-item">
                      <span class="config-label">Nouvelles inscriptions</span>
                      <div class="config-control">
                        <label class="switch">
                          <input type="checkbox" checked>
                          <span class="slider"></span>
                        </label>
                      </div>
                    </div>
                    <div class="config-item">
                      <span class="config-label">Logs de d√©bogage</span>
                      <div class="config-control">
                        <label class="switch">
                          <input type="checkbox">
                          <span class="slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="config-section">
                  <h4>S√©curit√©</h4>
                  <div class="config-list">
                    <div class="config-item">
                      <span class="config-label">Authentification 2FA</span>
                      <div class="config-control">
                        <label class="switch">
                          <input type="checkbox" checked>
                          <span class="slider"></span>
                        </label>
                      </div>
                    </div>
                    <div class="config-item">
                    <span class="config-label">Sessions s√©curis√©es</span>
                    <div class="config-control">
                      <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                      </label>
                    </div>
                  </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recent Activities -->
            <div class="system-activities">
              <h3>Activit√©s syst√®me r√©centes</h3>
              <div class="activity-log">
                <div class="log-item info">
                  <div class="log-time">Il y a 15 min</div>
                  <div class="log-message">Sauvegarde automatique effectu√©e avec succ√®s</div>
                  <div class="log-category">Syst√®me</div>
                </div>
                <div class="log-item warning">
                  <div class="log-time">Il y a 1h</div>
                  <div class="log-message">Tentative de connexion √©chou√©e (IP: 192.168.1.100)</div>
                  <div class="log-category">S√©curit√©</div>
                </div>
                <div class="log-item success">
                  <div class="log-time">Il y a 2h</div>
                  <div class="log-message">Nouvel utilisateur inscrit: marie.dupont@email.com</div>
                  <div class="log-category">Utilisateur</div>
                </div>
                <div class="log-item info">
                  <div class="log-time">Il y a 3h</div>
                  <div class="log-message">Mise √† jour des statistiques termin√©e</div>
                  <div class="log-category">Syst√®me</div>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="system-actions">
              <h3>Actions rapides</h3>
              <div class="action-buttons">
                <button class="btn btn-primary">
                  <span class="material-icons">backup</span>
                  Lancer sauvegarde
                </button>
                <button class="btn btn-secondary">
                  <span class="material-icons">refresh</span>
                  Vider le cache
                </button>
                <button class="btn btn-warning">
                  <span class="material-icons">build</span>
                  Mode maintenance
                </button>
                <button class="btn btn-outline">
                  <span class="material-icons">download</span>
                  Export logs
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Section -->
        <div *ngIf="activeSection === 'profile'" class="section-content profile-section">
          <!-- Profile Header -->
          <div class="profile-section-header" *ngIf="!isEditingProfile">
            <div class="section-title">
              <h2>Profil Administrateur</h2>
              <p>G√©rez votre profil administrateur</p>
            </div>
            <button class="btn btn-primary" (click)="startEditProfile()">
              <span class="material-icons">edit</span>
              Modifier mes informations
            </button>
          </div>

          <!-- Profile View Mode -->
          <div *ngIf="!isEditingProfile">
            <app-profile-view [user]="currentUser"></app-profile-view>
          </div>

          <!-- Profile Edit Mode -->
          <div *ngIf="isEditingProfile">
            <app-profile-sections 
              [user]="currentUser"
              (saved)="onProfileSaved($event)"
              (cancelled)="cancelEditProfile()"
              (passwordChanged)="onPasswordChanged()">
            </app-profile-sections>
          </div>
        </div>
      </div>

      <!-- Default/Loading State -->
      <div *ngIf="!currentUser" class="dashboard-content">
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Chargement de votre tableau de bord...</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Property Details Modal with Ratings & Comments -->
  <div class="annonce-details-modal" *ngIf="selectedAnnonce" (click)="closeAnnonceDetails()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ selectedAnnonce.titre }}</h2>
        <button class="close-button" (click)="closeAnnonceDetails()">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="modal-body">
        <!-- Property Images -->
        <div class="property-gallery">
          <div class="main-image">
            <img *ngIf="selectedAnnonce.premierImage" 
                 [src]="selectedAnnonce.premierImage" 
                 [alt]="selectedAnnonce.titre">
            <div *ngIf="!selectedAnnonce.premierImage" class="no-image-placeholder">
              <span class="material-icons">{{ selectedAnnonce.typeBien === 'VILLA' ? 'villa' : 'home' }}</span>
              <p>Aucune image disponible</p>
            </div>
            
            <!-- Transaction Badge -->
            <div class="transaction-badge modal-badge" [class]="'badge-' + selectedAnnonce.typeTransaction.toLowerCase()">
              {{ getAnnonceTypeTransactionDisplay(selectedAnnonce.typeTransaction) }}
            </div>
          </div>
        </div>

        <!-- Property Info -->
        <div class="property-info-grid">
          <div class="property-main-info">
            <div class="price-section">
              <div class="property-price large">{{ formatPrice(selectedAnnonce.prix) }}</div>
              <div class="property-type">{{ getAnnonceTypeBienDisplay(selectedAnnonce.typeBien) }}</div>
            </div>

            <div class="property-location">
              <span class="material-icons">location_on</span>
              <span>{{ selectedAnnonce.ville }}</span>
            </div>

            <!-- Property Details -->
            <div class="property-details-grid">
              <div class="detail-card" *ngIf="selectedAnnonce.surface">
                <span class="material-icons">square_foot</span>
                <div class="detail-info">
                  <div class="detail-value">{{ selectedAnnonce.surface }} m¬≤</div>
                  <div class="detail-label">Surface</div>
                </div>
              </div>
              
              <div class="detail-card" *ngIf="selectedAnnonce.nombreChambres">
                <span class="material-icons">bed</span>
                <div class="detail-info">
                  <div class="detail-value">{{ selectedAnnonce.nombreChambres }}</div>
                  <div class="detail-label">Chambres</div>
                </div>
              </div>
              
              <div class="detail-card" *ngIf="selectedAnnonce.nombreSallesBain">
                <span class="material-icons">bathtub</span>
                <div class="detail-info">
                  <div class="detail-value">{{ selectedAnnonce.nombreSallesBain }}</div>
                  <div class="detail-label">Salles de bain</div>
                </div>
              </div>
            </div>

            <!-- Features -->
            <div class="property-features-modal" *ngIf="selectedAnnonce.garage || selectedAnnonce.piscine || selectedAnnonce.jardin">
              <h4>√âquipements</h4>
              <div class="features-grid">
                <div class="feature-item" *ngIf="selectedAnnonce.garage">
                  <span class="material-icons">garage</span>
                  <span>Garage</span>
                </div>
                <div class="feature-item" *ngIf="selectedAnnonce.piscine">
                  <span class="material-icons">pool</span>
                  <span>Piscine</span>
                </div>
                <div class="feature-item" *ngIf="selectedAnnonce.jardin">
                  <span class="material-icons">yard</span>
                  <span>Jardin</span>
                </div>
              </div>
            </div>

            <!-- Agency Info -->
            <div class="agency-info" *ngIf="canViewFullDetails()">
              <h4>Agence</h4>
              <div class="agency-card">
                <span class="material-icons">business</span>
                <div class="agency-details">
                  <div class="agency-name">{{ selectedAnnonce.createurNom }}</div>
                  <div class="agency-type">{{ selectedAnnonce.createurType }}</div>
                </div>
                <button class="btn btn-primary" *ngIf="canContactAgency()">
                  <span class="material-icons">phone</span>
                  Contacter
                </button>
              </div>
            </div>
          </div>

          <!-- Ratings & Comments Section -->
          <div class="ratings-comments-section" *ngIf="canRateAndComment()">
            <!-- Average Rating Display -->
            <div class="average-rating">
              <h4>√âvaluations</h4>
              <div class="rating-display" *ngIf="annonceRatings[selectedAnnonce.id]; else noRating">
                <div class="rating-stars">
                  <span *ngFor="let star of [1,2,3,4,5]" 
                        class="material-icons rating-star"
                        [class.filled]="star <= annonceRatings[selectedAnnonce.id]">
                    star
                  </span>
                </div>
                <div class="rating-value">{{ annonceRatings[selectedAnnonce.id] | number:'1.1-1' }} / 5</div>
              </div>
              <ng-template #noRating>
                <p class="no-rating">Aucune √©valuation pour le moment</p>
              </ng-template>
            </div>

            <!-- Rating Submission -->
            <div class="rating-submission">
              <h5>√âvaluez ce bien</h5>
              <div class="rating-input">
                <span *ngFor="let star of [1,2,3,4,5]; let i = index" 
                      class="material-icons rating-star interactive"
                      [class.filled]="i < selectedRating"
                      (click)="selectedRating = i + 1"
                      (mouseover)="hoverRating = i + 1"
                      (mouseleave)="hoverRating = 0">
                  star
                </span>
              </div>
              <button class="btn btn-secondary" 
                      [disabled]="!selectedRating"
                      (click)="submitRating(selectedAnnonce.id, selectedRating)">
                Soumettre l'√©valuation
              </button>
            </div>

            <!-- Comments Section -->
            <div class="comments-section">
              <h4>Commentaires ({{ annonceComments[selectedAnnonce.id]?.length || 0 }})</h4>
              
              <!-- Comment Input -->
              <div class="comment-input">
                <textarea placeholder="Partagez votre avis sur ce bien..."
                          [(ngModel)]="newComment"
                          class="comment-textarea"
                          rows="3"></textarea>
                <button class="btn btn-primary comment-submit"
                        [disabled]="!newComment?.trim()"
                        (click)="submitComment(selectedAnnonce.id, newComment)">
                  <span class="material-icons">send</span>
                  Publier
                </button>
              </div>

              <!-- Comments List -->
              <div class="comments-list" *ngIf="annonceComments[selectedAnnonce.id]?.length">
                <div class="comment-item" 
                     *ngFor="let comment of annonceComments[selectedAnnonce.id]">
                  <div class="comment-author">
                    <div class="author-avatar">
                      {{ comment.userName.charAt(0) }}
                    </div>
                    <div class="author-info">
                      <div class="author-name">{{ comment.userName }}</div>
                      <div class="comment-date">{{ comment.createdAt | date:'short' }}</div>
                    </div>
                    <div class="comment-rating" *ngIf="comment.rating && comment.rating > 0">
                      <span *ngFor="let star of [1,2,3,4,5]" 
                            class="material-icons rating-star small"
                            [class.filled]="star <= comment.rating">
                        star
                      </span>
                    </div>
                  </div>
                  <div class="comment-text" *ngIf="comment.content && comment.content.trim()">
                    {{ comment.content }}
                  </div>
                  <div class="comment-text no-content" *ngIf="!comment.content || !comment.content.trim()">
                    <em style="color: #94a3b8;">√âvaluation sans commentaire</em>
                  </div>
                  
                  <!-- Display Replies if any -->
                  <div class="comment-replies" *ngIf="comment.replies && comment.replies.length > 0">
                    <div class="reply-item" *ngFor="let reply of comment.replies">
                      <div class="reply-author">
                        <div class="author-avatar agency">
                          <span class="material-icons">business</span>
                        </div>
                        <div class="author-info">
                          <div class="author-name">{{ reply.userName }} 
                            <span class="agency-badge">Agence</span>
                          </div>
                          <div class="reply-date">{{ reply.createdAt | date:'short' }}</div>
                        </div>
                      </div>
                      <div class="reply-content">{{ reply.content }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="no-comments" *ngIf="!annonceComments[selectedAnnonce.id]?.length">
                <span class="material-icons">comment</span>
                <p>Aucun commentaire pour le moment. Soyez le premier √† donner votre avis !</p>
              </div>
            </div>
          </div>

          <!-- Limited Access Message for Regular Users -->
          <div class="limited-access" *ngIf="!canRateAndComment()">
            <div class="upgrade-prompt">
              <span class="material-icons">lock</span>
              <h4>Fonctionnalit√©s Premium</h4>
              <p>√âvaluations et commentaires disponibles pour les utilisateurs inscrits.</p>
              <button class="btn btn-premium" (click)="setActiveSection('upgrade')">
                <span class="material-icons">star</span>
                S'inscrire
              </button>
            </div>
          </div>
        </div>

        <!-- Property Stats -->
        <div class="property-stats-modal">
          <div class="stat-item">
            <span class="material-icons">visibility</span>
            <span>{{ selectedAnnonce.vues }} vues</span>
          </div>
          <div class="stat-item" *ngIf="isClientAbonne()">
            <span class="material-icons">favorite</span>
            <span>{{ selectedAnnonce.favoris }} favoris</span>
          </div>
          <div class="stat-item">
            <span class="material-icons">schedule</span>
            <span>Publi√© le {{ formatAnnonceDate(selectedAnnonce.dateCreation) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
